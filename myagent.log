2025-11-21 09:40:36,084 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 09:40:36,085 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_094036
2025-11-21 09:40:38,111 - utils.error_handler - INFO - [cli_session_20251121_094036] [process_query] 处理查询: 女性来自河北省的人有哪些
2025-11-21 09:40:38,417 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 09:40:38,417 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 09:40:42,847 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 09:40:42,854 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 09:40:42,854 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 女性来自河北省的人有哪些
2025-11-21 09:40:42,855 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_094036]: 女性来自河北省的人有哪些
2025-11-21 09:40:43,793 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 09:40:43,795 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT `CUST_NAM` FROM customer_info WHERE `GENDER` = '2' AND `ADDRESS` LIKE '%河北省%';
2025-11-21 09:40:43,797 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 09:40:44,172 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 09:40:44,173 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回2行结果
2025-11-21 09:40:44,173 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回2行结果
2025-11-21 09:44:01,715 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 09:44:01,716 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_094401
2025-11-21 09:44:22,888 - utils.error_handler - INFO - [cli_session_20251121_094401] [process_query] 处理查询: 哪些人来自辽宁省
2025-11-21 09:44:23,206 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 09:44:23,206 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 09:44:28,192 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 09:44:28,199 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 09:44:28,199 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 哪些人来自辽宁省
2025-11-21 09:44:28,200 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_094401]: 哪些人来自辽宁省
2025-11-21 09:44:29,026 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 09:44:29,028 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT `CUST_NAM` FROM customer_info WHERE `ADDRESS` LIKE '%辽宁省%';
2025-11-21 09:44:29,029 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 09:44:29,533 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 09:44:29,536 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回3行结果
2025-11-21 09:44:29,537 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回3行结果
2025-11-21 09:44:29,540 - __main__ - INFO - 最终查询结果来自辽宁省的人有：李林、陈辉和吴婷。
2025-11-21 10:56:04,818 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 10:56:04,818 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_105604
2025-11-21 10:56:10,081 - utils.error_handler - INFO - [cli_session_20251121_105604] [process_query] 处理查询: 哪些人来自辽宁省
2025-11-21 10:56:10,394 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 10:56:10,394 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 10:56:15,913 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 10:56:15,920 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 10:56:15,920 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 哪些人来自辽宁省
2025-11-21 10:56:15,921 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_105604]: 哪些人来自辽宁省
2025-11-21 10:56:16,746 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 10:56:16,747 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT `CUST_NAM` FROM customer_info WHERE `ADDRESS` LIKE '%辽宁省%';
2025-11-21 10:56:16,749 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 10:56:17,232 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 10:56:17,233 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回3行结果
2025-11-21 10:56:17,233 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回3行结果
2025-11-21 10:56:17,235 - __main__ - INFO - 最终查询结果来自辽宁省的人有：李林、陈辉、吴婷。
2025-11-21 11:23:20,099 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 11:23:20,100 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_112320
2025-11-21 11:23:35,291 - utils.error_handler - INFO - [cli_session_20251121_112320] [process_query] 处理查询: 找出性别为男性的客户的所有信息
2025-11-21 11:23:35,616 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 11:23:35,616 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 11:23:42,384 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 11:23:42,392 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 11:23:42,392 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 找出性别为男性的客户的所有信息
2025-11-21 11:23:42,392 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_112320]: 找出性别为男性的客户的所有信息
2025-11-21 11:23:43,817 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 11:23:43,819 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT `CUST_NO`, `CUST_NAM`, `ID_TYPE`, `ID_NO`, `BIRTH_DT`, `GENDER`, `MOBILE_N`, `ADDRESS`, `OCCUP_CD`, `RISK_LEVEL`, `CUST_STATUS`, `OPEN_ORG` FROM customer_info WHERE `GENDER` = '1';
2025-11-21 11:23:43,821 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 11:23:51,596 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 11:23:51,598 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回288行结果
2025-11-21 11:23:51,598 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回288行结果
2025-11-21 11:23:51,600 - __main__ - INFO - 最终查询结果根据查询结果，性别为男性的客户共有288行数据。以下是部分示例信息：

1. 客户编号：C1178779231191697253，姓名：闭倩，性别：1，身份证号：511901********0925，出生日期：19840102，手机号：13*****3068，地址：吉林省佛山县南溪南京路L座 249663。
2. 客户编号：C1332300930545077819，姓名：谢峰，性别：1，身份证号：E67684996，出生日期：19800322，手机号：17*****1685，地址：四川省齐齐哈尔市萧山戴路p座 726025。
3. 客户编号：C1483295667183099926，姓名：钟林，性别：1，身份证号：E18530615，出生日期：19920203，手机号：19*****8344，地址：香港特别行政区大冶市兴山彭街E座 261771。
4. 客户编号：C1540816135395114740，姓名：吴冬梅，性别：1，身份证号：620401********872X，出生日期：19820507，手机号：17*****5861，地址：重庆市辽阳市锡山呼和浩特街e座 136193。
5. 客户编号：C1896179073998708285，姓名：陈丽丽，性别：1，身份证号：E14478111，出生日期：19950810，手机号：15*****6977，地址：山西省晶县南湖关岭路k座 274517。

以上是部分客户的详细信息，完整数据包含288条记录。如需进一步分析或提取特定信息，请告知。
2025-11-21 13:07:08,759 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 13:07:08,760 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_130708
2025-11-21 13:07:10,716 - utils.error_handler - INFO - [cli_session_20251121_130708] [process_query] 处理查询: 找出性别为男性的客户的所有信息
2025-11-21 13:07:11,049 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 13:07:11,050 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 13:07:15,443 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:07:15,469 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 13:07:15,470 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 找出性别为男性的客户的所有信息
2025-11-21 13:07:15,470 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_130708]: 找出性别为男性的客户的所有信息
2025-11-21 13:07:16,599 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:07:16,601 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT `CUST_NO`, `CUST_NAM`, `ID_TYPE`, `ID_NO`, `BIRTH_DT`, `GENDER`, `MOBILE_N`, `ADDRESS`, `OCCUP_CD`, `RISK_LEVEL`, `CUST_STATUS`, `OPEN_ORG` FROM customer_info WHERE `GENDER` = '1';
2025-11-21 13:07:16,603 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 13:07:22,712 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:07:22,715 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回288行结果
2025-11-21 13:07:22,716 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回288行结果
2025-11-21 13:07:22,723 - __main__ - INFO - 最终查询结果根据查询结果，共有288条性别为男性的客户信息。以下是部分示例数据：

1. 客户编号：C1178779231191697253，姓名：闭倩，性别：男，身份证号：511901********0925，出生日期：19840102，手机号：13*****3068，地址：吉林省佛山县南溪南京路L座 249663。
2. 客户编号：C1332300930545077819，姓名：谢峰，性别：男，身份证号：E67684996，出生日期：19800322，手机号：17*****1685，地址：四川省齐齐哈尔市萧山戴路p座 726025。
3. 客户编号：C1483295667183099926，姓名：钟林，性别：男，身份证号：E18530615，出生日期：19920203，手机号：19*****8344，地址：香港特别行政区大冶市兴山彭街E座 261771。
4. 客户编号：C1540816135395114740，姓名：吴冬梅，性别：男，身份证号：620401********872X，出生日期：19820507，手机号：17*****5861，地址：重庆市辽阳市锡山呼和浩特街e座 136193。
5. 客户编号：C1896179073998708285，姓名：陈丽丽，性别：男，身份证号：E14478111，出生日期：19950810，手机号：15*****6977，地址：山西省晶县南湖关岭路k座 274517。

以上是部分客户的详细信息，完整数据包含288条记录。如需进一步分析或提取特定信息，请告知。
2025-11-21 13:08:01,892 - utils.error_handler - INFO - [cli_session_20251121_130708] [process_query] 处理查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:08:07,410 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:08:07,411 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 13:08:07,411 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:08:07,412 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_130708]: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:08:08,768 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:08:08,771 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT `CUST_NO`, `CUST_NAM`, `ID_TYPE`, `ID_NO`, `BIRTH_DT`, `GENDER`, `MOBILE_N`, `ADDRESS`, `OCCUP_CD`, `RISK_LEVEL`, `CUST_STATUS`, `OPEN_ORG` FROM customer_info WHERE `CUST_NO` = 'C1896179073998708285';
2025-11-21 13:08:08,774 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 13:08:11,731 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:08:11,732 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回12行结果
2025-11-21 13:08:11,732 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回12行结果
2025-11-21 13:08:11,734 - __main__ - INFO - 最终查询结果客户编号为 **C1896179073998708285** 的客户信息如下：

- **客户编号（CUST_NO）**：C1896179073998708285  
- **客户姓名（CUST_NAM）**：陈丽丽  
- **证件类型（ID_TYPE）**：02  
- **证件号码（ID_NO）**：E14478111  
- **出生日期（BIRTH_DT）**：19950810  
- **性别（GENDER）**：1  
- **手机号码（MOBILE_N）**：15*****6977  
- **地址（ADDRESS）**：山西省晶县南湖关岭路k座 274517  
- **职业代码（OCCUP_CD）**：202028  
- **风险等级（RISK_LEVEL）**：01  
- **客户状态（CUST_STATUS）**：0  
- **开户机构（OPEN_ORG）**：110004696  

以上是该客户的所有相关信息。
2025-11-21 13:16:19,517 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 13:16:19,518 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_131619
2025-11-21 13:16:22,648 - utils.error_handler - INFO - [cli_session_20251121_131619] [process_query] 处理查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:16:22,972 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 13:16:22,972 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 13:16:27,867 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:16:27,876 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 13:16:27,876 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:16:27,876 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_131619]: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:16:35,188 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:16:35,190 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT * FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON (deposit_business.PROD_CD = product_info.PROD_CD OR loan_business.PROD_CD = product_info.PROD_CD) WHERE customer_info.CUST_NO = 'C1896179073998708285'
2025-11-21 13:16:35,193 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 13:16:49,432 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:16:49,436 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回86行结果
2025-11-21 13:16:49,436 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回86行结果
2025-11-21 13:16:49,445 - __main__ - INFO - 最终查询结果客户编号为 **C1896179073998708285** 的客户信息如下：

### 客户基本信息：
- **客户编号（CUST_NO）**：C1896179073998708285  
- **姓名（NAME）**：陈丽丽  
- **证件类型（ID_TYPE）**：02  
- **证件号码（ID_NO）**：E14478111  
- **出生日期（BIRTH_DATE）**：19950810  
- **性别（GENDER）**：1  
- **手机号码（MOBILE_PHONE）**：15*****6977  
- **地址（ADDRESS）**：山西省晶县南湖关岭路k座 274517  
- **职业代码（OCCUPATION_CODE）**：202028  
- **学历代码（EDUCATION_CODE）**：01  
- **婚姻状况（MARITAL_STATUS）**：0  
- **组织机构代码（ORGANIZATION_CODE）**：110004696  
- **银行卡号（ACCOUNT_NO）**：6222023454230047613  

---

### 存款业务信息：
1. **存款编号（DEP_NO）**：DEP2024003  
   - **产品代码（PROD_CD）**：DEP02  
   - **账户余额（BALANCE）**：Decimal('0.00')  
   - **可用余额（AVAIL_BALANCE）**：Decimal('763167.70')  
   - **冻结金额（FROZEN_AMOUNT）**：Decimal('0.00')  
   - **到期日（MATURITY_DATE）**：20250727  
   - **生效日期（EFFECTIVE_DATE）**：20250918  
   - **本金（PRINCIPAL）**：Decimal('610534.16')  
   - **贷款编号（LOAN_NO）**：LN20240568723429693454  
   - **贷款产品代码（LOAN_PROD_CD）**：PDL02  
   - **贷款总额（LOAN_AMOUNT）**：Decimal('1276211.90')  
   - **已还金额（PAID_AMOUNT）**：Decimal('1098407.98')  
   - **起始日期（START_DATE）**：20230912  
   - **结束日期（END_DATE）**：20300227  
   - **利率（RATE）**：Decimal('4.4177')  
   - **产品类型（PROD_TYPE）**：PDL  
   - **产品名称（PROD_NAME）**：1年定期存款  
   - **产品类别（PROD_CATEGORY）**：DEP  
   - **产品子类（SUB_PRODCAT）**：DEP02  
   - **初始金额（INITIAL_AMT）**：Decimal('1000.00')  
   - **期限（TERM）**：360  
   - **利率（INTEREST_RATE）**：Decimal('1.5000')  
   - **状态（STATUS）**：0  

2. **存款编号（DEP_NO）**：LN2024002  
   - **产品代码（PROD_CD）**：PDL02  
   - **账户余额（BALANCE）**：Decimal('0.00')  
   - **可用余额（AVAIL_BALANCE）**：Decimal('763167.70')  
   - **冻结金额（FROZEN_AMOUNT）**：Decimal('0.00')  
   - **到期日（MATURITY_DATE）**：20250727  
   - **生效日期（EFFECTIVE_DATE）**：20250918  
   - **本金（PRINCIPAL）**：Decimal('610534.16')  
   - **贷款编号（LOAN_NO）**：LN20240568723429693454  
   - **贷款产品代码（LOAN_PROD_CD）**：PDL02  
   - **贷款总额（LOAN_AMOUNT）**：Decimal('1276211.90')  
   - **已还金额（PAID_AMOUNT）**：Decimal('1098407.98')  
   - **起始日期（START_DATE）**：20230912  
   - **结束日期（END_DATE）**：20300227  
   - **利率（RATE）**：Decimal('4.4177')  
   - **产品类型（PROD_TYPE）**：PDL  
   - **产品名称（PROD_NAME）**：个人消费贷款  
   - **产品类别（PROD_CATEGORY）**：LN  
   - **产品子类（SUB_PRODCAT）**：PDL02  
   - **初始金额（INITIAL_AMT）**：Decimal('0.00')  
   - **期限（TERM）**：None  
   - **利率（INTEREST_RATE）**：Decimal('6.8000')  
   - **状态（STATUS）**：0  

---

### 其他信息：
- **产品代码（PROD_CD）**：DEP02、PDL02  
- **产品名称（PROD_NAME）**：1年定期存款、个人消费贷款  
- **产品类型（PROD_TYPE）**：DEP、LN  
- **产品类别（PROD_CATEGORY）**：DEP02、PDL02  
- **利率（RATE）**：4.4177、6.8000  
- **状态（STATUS）**：0  

以上是该客户的所有相关信息。
2025-11-21 13:23:47,464 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 13:23:47,464 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_132347
2025-11-21 13:24:02,358 - utils.error_handler - INFO - [cli_session_20251121_132347] [process_query] 处理查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:24:02,673 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 13:24:02,674 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 13:24:10,774 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:24:10,784 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 13:24:10,784 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:24:10,785 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_132347]: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:24:17,499 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:24:17,503 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.*, deposit_business.*, loan_business.*, product_info.* FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON (deposit_business.PROD_CD = product_info.PROD_CD OR loan_business.PROD_CD = product_info.PROD_CD) WHERE customer_info.CUST_NO = 'C1896179073998708285'
2025-11-21 13:24:17,515 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 13:24:38,211 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:24:38,215 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回86行结果
2025-11-21 13:24:38,216 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回86行结果
2025-11-21 13:24:38,222 - __main__ - INFO - 查询成功完成，已显示解释结果
2025-11-21 13:29:26,323 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 13:29:26,324 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_132926
2025-11-21 13:33:17,094 - utils.error_handler - INFO - [cli_session_20251121_132926] [process_query] 处理查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:33:17,468 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 13:33:17,468 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 13:33:25,355 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:33:25,369 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 13:33:25,370 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:33:25,370 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_132926]: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:33:32,846 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:33:32,848 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT * FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON (deposit_business.PROD_CD = product_info.PROD_CD OR loan_business.PROD_CD = product_info.PROD_CD) WHERE customer_info.CUST_NO = 'C1896179073998708285';
2025-11-21 13:33:32,850 - text2sql_module.text2sql_processor - INFO - SQL执行成功，原始结果已保留供大模型处理
2025-11-21 13:33:49,436 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:33:49,438 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回86行结果
2025-11-21 13:33:49,438 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回86行结果
2025-11-21 13:33:49,442 - __main__ - INFO - 查询成功完成，已显示解释结果
2025-11-21 13:48:35,603 - __main__ - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 13:48:35,604 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_134835
2025-11-21 13:48:38,082 - utils.error_handler - INFO - [cli_session_20251121_134835] [process_query] 处理查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:48:38,422 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 13:48:38,422 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 13:48:45,753 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:48:45,760 - base_agent.agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 13:48:45,761 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:48:45,761 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_134835]: 给出客户编号：C1896179073998708285的客户的所有表的信息
2025-11-21 13:48:51,712 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:48:51,714 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.*, deposit_business.*, loan_business.*, product_info.* FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON (deposit_business.PROD_CD = product_info.PROD_CD OR loan_business.PROD_CD = product_info.PROD_CD) WHERE customer_info.CUST_NO = 'C1896179073998708285';
2025-11-21 13:48:51,719 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 13:49:10,765 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 13:49:10,767 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 13:49:10,768 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回1行结果
2025-11-21 13:49:10,776 - __main__ - INFO - 查询成功完成，已显示解释结果
2025-11-21 14:01:07,364 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 14:01:07,365 - test_auto_init - INFO - 这是通过get_logger自动初始化的日志信息
2025-11-21 14:01:07,365 - test_auto_init - WARNING - 这是通过get_logger自动初始化的警告信息
2025-11-21 14:01:07,366 - test_manual_init - INFO - 这是通过手动init_logger初始化的日志信息
2025-11-21 14:01:07,366 - test_manual_init - ERROR - 这是通过手动init_logger初始化的错误信息
2025-11-21 14:01:07,366 - test_no_repeat_init - INFO - 第一次初始化后的日志
2025-11-21 14:01:07,366 - test_no_repeat_init - INFO - 尝试再次初始化后的日志
2025-11-21 14:01:24,019 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 14:01:24,020 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 14:01:24,020 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_140124
2025-11-21 14:01:47,202 - utils.error_handler - INFO - [cli_session_20251121_140124] [process_query] 处理查询: 男客户一共多少人？
2025-11-21 14:01:47,512 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 14:01:47,513 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 14:01:53,133 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 14:01:53,153 - base_agent.agent_manager - INFO - 解析意图成功: data_count
2025-11-21 14:01:53,154 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 男客户一共多少人？
2025-11-21 14:01:53,154 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_140124]: 男客户一共多少人？
2025-11-21 14:01:55,201 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 14:01:55,202 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS male_customer_count FROM customer_info WHERE GENDER = '1'
2025-11-21 14:01:55,204 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 14:01:55,498 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 14:01:55,499 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 14:01:55,499 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回1行结果
2025-11-21 14:01:55,500 - __main__ - INFO - 查询成功完成，已显示解释结果
2025-11-21 14:03:27,367 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 14:03:27,368 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 14:03:27,368 - base_agent.agent_manager - INFO - 创建新会话: cli_session_20251121_140327
2025-11-21 14:03:34,323 - utils.error_handler - INFO - [cli_session_20251121_140327] [process_query] 处理查询: 女客户一共多少人？
2025-11-21 14:03:34,648 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 14:03:34,649 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 14:03:43,476 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 14:03:43,482 - base_agent.agent_manager - INFO - 解析意图成功: data_count
2025-11-21 14:03:43,483 - base_agent.agent_manager - INFO - 使用Text2SQL处理数据查询: 女客户一共多少人？
2025-11-21 14:03:43,483 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_140327]: 女客户一共多少人？
2025-11-21 14:03:45,347 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 14:03:45,348 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS female_customer_count FROM customer_info WHERE GENDER = '2'
2025-11-21 14:03:45,350 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 14:03:45,633 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 14:03:45,637 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 14:03:45,638 - base_agent.agent_manager - INFO - Text2SQL查询成功，返回1行结果
2025-11-21 14:03:45,641 - __main__ - INFO - 女客户一共有26人。,查询成功完成，已显示解释结果
2025-11-21 15:17:01,715 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 15:17:01,716 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 15:17:01,716 - __main__ - ERROR - 系统启动失败: 'SimpleAgentManager' object has no attribute 'create_session'
2025-11-21 15:18:48,753 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 15:18:48,753 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 15:18:48,754 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251121_151848
2025-11-21 15:18:52,215 - base_agent.simple_agent_manager - INFO - 处理查询: 女客户一共多少人？
2025-11-21 15:18:53,219 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 15:18:53,219 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 15:18:57,599 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 15:18:57,606 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-21 15:18:57,606 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 女客户一共多少人？
2025-11-21 15:18:57,607 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_151848]: 女客户一共多少人？
2025-11-21 15:18:59,704 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 15:18:59,706 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS female_customer_count FROM customer_info WHERE GENDER = '2'
2025-11-21 15:18:59,707 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 15:19:00,024 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 15:19:00,026 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 15:19:00,028 - __main__ - INFO - 女客户一共有26人。,查询成功完成，已显示解释结果
2025-11-21 15:19:38,585 - base_agent.simple_agent_manager - INFO - 处理查询: 安徽省客户有哪些？
2025-11-21 15:19:43,393 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 15:19:43,394 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 15:19:43,394 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 安徽省客户有哪些？
2025-11-21 15:19:43,394 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_151848]: 安徽省客户有哪些？
2025-11-21 15:19:45,781 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 15:19:45,782 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.* FROM customer_info WHERE customer_info.ADDRESS LIKE '%安徽省%';
2025-11-21 15:19:45,784 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 15:19:46,143 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 15:19:46,145 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 15:19:46,146 - __main__ - INFO - 安徽省的客户是：田建华。,查询成功完成，已显示解释结果
2025-11-21 16:10:11,837 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 16:10:11,837 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 16:10:11,838 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251121_161011
2025-11-21 16:11:02,877 - base_agent.simple_agent_manager - INFO - 处理查询: 哪些客户的风险等级是高的？
2025-11-21 16:11:03,833 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 16:11:03,834 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 16:11:08,379 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 16:11:08,386 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 16:11:08,386 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 哪些客户的风险等级是高的？
2025-11-21 16:11:08,387 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_161011]: 哪些客户的风险等级是高的？
2025-11-21 16:11:11,540 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 16:11:11,547 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NO, customer_info.CUST_NAM, customer_info.RISK_LEVEL FROM customer_info WHERE customer_info.RISK_LEVEL = '03'
2025-11-21 16:11:11,549 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 16:11:12,991 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 16:11:12,994 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 16:11:12,997 - __main__ - INFO - 根据查询结果，风险等级为高的客户有以下12位：

1. 谢峰  
2. 杨玉梅  
3. 赵金凤  
4. 黄婷婷  
5. 田建华  
6. 李艳  
7. 安凤英  
8. 冉亮  
9. 魏斌  
10. 柏云  
11. 杨丽  
12. 李楠,查询成功完成，已显示解释结果
2025-11-21 16:20:25,852 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 16:20:25,852 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 16:20:25,852 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251121_162025
2025-11-21 16:21:05,019 - base_agent.simple_agent_manager - INFO - 处理查询: 你知道客户中是辽宁省且是女客户的有哪些吗
2025-11-21 16:21:06,178 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 16:21:06,178 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 16:21:10,393 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 16:21:10,399 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 16:21:10,400 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 你知道客户中是辽宁省且是女客户的有哪些吗
2025-11-21 16:21:10,400 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_162025]: 你知道客户中是辽宁省且是女客户的有哪些吗
2025-11-21 16:21:13,005 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 16:21:13,007 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.* FROM customer_info WHERE customer_info.ADDRESS LIKE '%辽宁省%' AND customer_info.GENDER = '2'
2025-11-21 16:21:13,009 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 16:21:15,298 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 16:21:15,301 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 16:21:15,304 - __main__ - INFO - 根据查询结果，辽宁省且是女性的客户有以下三位：

1. 客户编号：C1126124671950375198，姓名：李林，地址：辽宁省坤市龙潭杨路s座 999727  
2. 客户编号：C3657268042843766758，姓名：陈辉，地址：辽宁省琳市涪城张街e座 567065  
3. 客户编号：C4693497617381082320，姓名：吴婷，地址：辽宁省银川市金平长沙街X座 679979,查询成功完成，已显示解释结果
2025-11-21 17:01:15,252 - base_agent.simple_agent_manager - INFO - 处理查询: 哪些客户是浙江省的
2025-11-21 17:01:21,066 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:01:21,068 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-21 17:01:21,069 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 哪些客户是浙江省的
2025-11-21 17:01:21,069 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_162025]: 哪些客户是浙江省的
2025-11-21 17:01:24,011 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:01:24,012 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.* FROM customer_info WHERE customer_info.ADDRESS LIKE '%浙江省%';
2025-11-21 17:01:24,014 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 17:01:25,214 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:01:25,215 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 17:01:25,216 - __main__ - INFO - 根据查询结果，浙江省的客户有：

1. 客户编号：C8821725552828636911，姓名：李楠  
2. 客户编号：C9682950886749549296，姓名：牛建军,查询成功完成，已显示解释结果
2025-11-21 17:04:13,809 - base_agent.simple_agent_manager - INFO - 处理查询: print("❌ 用法: sql <查询内容>")
2025-11-21 17:04:27,307 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 17:04:27,307 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 17:04:27,307 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251121_170427
2025-11-21 17:13:15,613 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-21 17:13:15,614 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-21 17:13:15,614 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251121_171315
2025-11-21 17:13:59,079 - base_agent.simple_agent_manager - INFO - 处理查询: 高风险客户比低风险客户多还是少
2025-11-21 17:14:00,080 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-21 17:14:00,081 - utils.llm_client - INFO - 使用.env文件配置
2025-11-21 17:14:04,966 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:14:04,973 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_comparison
2025-11-21 17:15:02,684 - base_agent.simple_agent_manager - INFO - 处理查询: 高风险客户有多少人？
2025-11-21 17:15:09,525 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:15:09,529 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-21 17:15:09,530 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 高风险客户有多少人？
2025-11-21 17:15:09,531 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251121_171315]: 高风险客户有多少人？
2025-11-21 17:15:11,989 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:15:11,991 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS high_risk_customer_count FROM customer_info WHERE RISK_LEVEL = '03'
2025-11-21 17:15:11,992 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-21 17:15:12,357 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 17:15:12,358 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-21 17:15:12,360 - __main__ - INFO - 高风险客户共有12人。,查询成功完成，已显示解释结果
2025-11-24 08:41:32,459 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 08:41:32,463 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 08:41:32,463 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_084132
2025-11-24 08:45:11,560 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 08:45:11,561 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 08:45:11,561 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_084511
2025-11-24 08:48:32,021 - base_agent.simple_agent_manager - INFO - 处理查询: 本月应还贷款超过5000元的有哪些客户？列举出来
2025-11-24 08:48:32,317 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 08:48:32,318 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 08:48:37,780 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 08:48:37,788 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 08:48:37,788 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 本月应还贷款超过5000元的有哪些客户？列举出来
2025-11-24 08:48:37,788 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_084511]: 本月应还贷款超过5000元的有哪些客户？列举出来
2025-11-24 08:48:41,996 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 08:48:42,004 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT DISTINCT customer_info.CUST_NO, customer_info.CUST_NAM FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE loan_business.MTH_DUE_AMT > 5000
2025-11-24 08:48:42,014 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 08:48:45,140 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 08:48:45,144 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 08:48:45,149 - __main__ - INFO - 本月应还贷款超过5000元的客户有以下几位：

1. 陈丽丽（C1896179073998708285）  
2. 郑博（C3252323796025610208）  
3. 邵春梅（C1740778069171352050）  
4. 杨淑华（C8469233472095616891）  
5. 秦飞（C7867621057104736837）  
6. 黄瑞（C2834631103129155783）  
7. 钟林（C1483295667183099926）,查询成功完成，已显示解释结果
2025-11-24 08:49:46,315 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 08:49:46,315 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 08:49:46,316 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_084946
2025-11-24 08:50:41,761 - base_agent.simple_agent_manager - INFO - 处理查询: 秦飞买的还款方式是什么样的？
2025-11-24 08:50:42,062 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 08:50:42,062 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 08:50:45,773 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 08:50:45,780 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 08:50:45,780 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 秦飞买的还款方式是什么样的？
2025-11-24 08:50:45,780 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_084946]: 秦飞买的还款方式是什么样的？
2025-11-24 08:50:49,132 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 08:50:49,139 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT loan_business.REPAY_MODE FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE customer_info.CUST_NAM = '秦飞';
2025-11-24 08:50:49,143 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 08:50:49,579 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 08:50:49,584 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 08:50:49,589 - __main__ - INFO - 秦飞的还款方式为“002”。,查询成功完成，已显示解释结果
2025-11-24 09:34:03,196 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 09:34:03,197 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 09:34:03,197 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_093403
2025-11-24 09:35:19,651 - base_agent.simple_agent_manager - INFO - 处理查询: 哪些人购买了产品风险等级为1的产品，请给出这些人的详细信息
2025-11-24 09:35:19,953 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 09:35:19,953 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 09:35:24,522 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 09:35:24,549 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 09:35:24,550 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 哪些人购买了产品风险等级为1的产品，请给出这些人的详细信息
2025-11-24 09:35:24,550 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_093403]: 哪些人购买了产品风险等级为1的产品，请给出这些人的详细信息
2025-11-24 09:35:29,739 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 09:35:29,742 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.* FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN product_info ON deposit_business.PROD_CD = product_info.PROD_CD WHERE product_info.PROD_RISK = '01' UNION SELECT customer_info.* FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON loan_business.PROD_CD = product_info.PROD_CD WHERE product_info.PROD_RISK = '01';
2025-11-24 09:35:29,753 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 09:35:49,994 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 09:35:49,996 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 09:35:49,997 - __main__ - INFO - 根据查询结果，购买了产品风险等级为1（'01'）的产品的人员有以下详细信息：

1. **柏云**  
   - 客户编号：C7237985331601353879  
   - 身份证号：620724********7543  
   - 出生日期：1995年10月11日  
   - 电话号码：17*****7242  
   - 地址：河北省深圳市吉区佛山路h座 200471  

2. **陈辉**  
   - 客户编号：C3657268042843766758  
   - 身份证号：410526********7984  
   - 出生日期：1976年6月12日  
   - 电话号码：19*****9443  
   - 地址：辽宁省琳市涪城张街e座 567065  

3. **吴冬梅**  
   - 客户编号：C1540816135395114740  
   - 身份证号：620401********872X  
   - 出生日期：1982年5月7日  
   - 电话号码：17*****5861  
   - 地址：重庆市辽阳市锡山呼和浩特街e座 136193  

4. **杨丽**  
   - 客户编号：C8616057403817185103  
   - 身份证号：340302********6502  
   - 出生日期：1992年9月15日  
   - 电话号码：18*****6325  
   - 地址：台湾省齐齐哈尔县怀柔罗街p座 878377  

5. **孙凤英**  
   - 客户编号：C6090539671807248618  
   - 身份证号：530400********605X  
   - 出生日期：2001年3月23日  
   - 电话号码：13*****8749  
   - 地址：云南省汕尾市城北潜江街a座 662174  

6. **陈利**  
   - 客户编号：C6053828718333823701  
   - 身份证号：620501********7387  
   - 出生日期：1991年12月27日  
   - 电话号码：17*****3780  
   - 地址：河南省俊市白云武汉街p座 491769  

7. **匡想**  
   - 客户编号：C6437979364979271427  
   - 身份证号：320581********8241  
   - 出生日期：1977年6月8日  
   - 电话号码：17*****1893  
   - 地址：江苏省旭市城东徐街q座 111671  

8. **李林**  
   - 客户编号：C1126124671950375198  
   - 身份证号：152500********4677  
   - 出生日期：1991年12月15日  
   - 电话号码：18*****4993  
   - 地址：辽宁省坤市龙潭杨路s座 999727  

9. **徐桂香**  
   - 客户编号：C1024679213467600282  
   - 身份证号：130603********1348  
   - 出生日期：2002年9月10日  
   - 电话号码：17*****4241  
   - 地址：吉林省长沙县沙市成都路C座 974648  

10. **黄成**  
    - 客户编号：C6382141273297107061  
    - 身份证号：430426********2698  
    - 出生日期：1978年1月18日  
    - 电话号码：18*****7304  
    - 地址：新疆维吾尔自治区磊市丰都李路D座 548281  

11. **冉亮**  
    - 客户编号：C7118680932951494750  
    - 身份证号：150929********9359  
    - 出生日期：1982年10月25日  
    - 电话号码：18*****5325  
    - 地址：湖南省西宁县上街北镇街k座 286801  

12. **杨浩**  
    - 客户编号：C3506129550120306036  
    - 身份证号：211381********1661  
    - 出生日期：1987年2月23日  
    - 电话号码：13*****9890  
    - 地址：甘肃省杭州县高明马路W座 868893  

13. **左婷**  
    - 客户编号：C7120741351818422971  
    - 身份证号：530422********4869  
    - 出生日期：1997年10月13日  
    - 电话号码：18*****6381  
    - 地址：澳门特别行政区嘉禾县秀英张街X座 533221  

14. **杨淑华**  
    - 客户编号：C8469233472095616891  
    - 身份证号：211381********1823  
    - 出生日期：1977年3月21日  
    - 电话号码：17*****5059  
    - 地址：青海省淮安县城东金街e座 318644  

15. **吴婷**  
    - 客户编号：C4693497617381082320  
    - 身份证号：360423********1886  
    - 出生日期：1982年6月26日  
    - 电话号码：15*****6724  
    - 地址：辽宁省银川市金平长沙街X座 679979  

16. **赵金凤**  
    - 客户编号：C2483347477109433712  
    - 身份证号：513426********5454  
    - 出生日期：1979年10月31日  
    - 电话号码：15*****7622  
    - 地址：新疆维吾尔自治区鹏市合川韩街r座 447710  

以上是所有购买了产品风险等级为1的客户信息。,查询成功完成，已显示解释结果
2025-11-24 10:03:13,813 - base_agent.simple_agent_manager - INFO - 处理查询: 按逾期天数对客户姓名进行排序
2025-11-24 10:03:19,400 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:03:19,401 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 10:08:57,123 - base_agent.simple_agent_manager - INFO - 处理查询: 按客户年龄对客户进行排序
2025-11-24 10:09:02,314 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:09:02,315 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 10:28:59,511 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 10:28:59,511 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 10:28:59,512 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_102859
2025-11-24 10:29:03,244 - base_agent.simple_agent_manager - INFO - 处理查询: 按逾期天数对客户姓名进行排序
2025-11-24 10:29:03,537 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 10:29:03,537 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 10:29:09,161 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:29:09,187 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 10:29:09,188 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 按逾期天数对客户姓名进行排序
2025-11-24 10:29:09,189 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_102859]: 按逾期天数对客户姓名进行排序
2025-11-24 10:29:13,923 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:29:13,925 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NAM, loan_business.OVERDUE_DAYS FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO ORDER BY loan_business.OVERDUE_DAYS ASC
2025-11-24 10:29:13,928 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 10:29:17,758 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:29:17,760 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 10:29:17,760 - __main__ - INFO - 根据查询结果，按逾期天数对客户姓名进行排序后，结果显示所有客户的逾期天数均为0或以上。以下是按逾期天数升序排列的客户姓名列表：

- 郑博 (0)
- 钟林 (0)
- 冉亮 (0)
- 龚欢 (0)
- 杨淑华 (0)
- 吴冬梅 (0)
- 秦飞 (0)
- 魏斌 (0)
- 黄瑞 (0)
- 钟林 (0)
- 吴秀云 (0)
- 李红梅 (0)
- 刘旭 (0)
- 吴冬梅 (0)
- 郑博 (0)
- 王雪梅 (3)
- 郑博 (3)
- 王雪梅 (66)
- 杨淑华 (66)
- 田建华 (82)
- 杜秀珍 (85)
- 黄瑞 (90)
- 黄成 (93)
- 邵春梅 (95)
- 韩晶 (113)
- 王雪梅 (116)
- 陈丽丽 (143)
- 龚欢 (150)
- 徐桂香 (162)
- 赵金凤 (163),查询成功完成，已显示解释结果
2025-11-24 10:33:30,643 - base_agent.simple_agent_manager - INFO - 处理查询: 请你对客户的年龄进行排序，从小到大排序
2025-11-24 10:33:34,993 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:33:34,994 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 10:33:34,994 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 请你对客户的年龄进行排序，从小到大排序
2025-11-24 10:33:34,994 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_102859]: 请你对客户的年龄进行排序，从小到大排序
2025-11-24 10:33:38,139 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:33:38,144 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NO, customer_info.CUST_NAM, TIMESTAMPDIFF(YEAR, STR_TO_DATE(customer_info.BIRTH_DT, '%Y%m%d'), CURDATE()) AS 年龄 FROM customer_info ORDER BY 年龄 ASC
2025-11-24 10:33:38,158 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 10:33:44,932 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:33:44,934 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 10:33:44,934 - __main__ - INFO - 根据查询结果，客户的年龄已按从小到大的顺序排序。以下是按年龄升序排列的客户信息：

1. 成文，年龄：18  
2. 韩晶，年龄：20  
3. 黄瑞，年龄：20  
4. 王雪梅，年龄：20  
5. 吴秀云，年龄：21  
6. 徐桂香，年龄：23  
7. 龚欢，年龄：23  
8. 黄婷婷，年龄：24  
9. 孙凤英，年龄：24  
10. 刘旭，年龄：26  
11. 邵春梅，年龄：28  
12. 左婷，年龄：28  
13. 马莉，年龄：29  
14. 秦飞，年龄：30  
15. 陈丽丽，年龄：30  
16. 柏云，年龄：30  
17. 杜秀珍，年龄：30  
18. 李艳，年龄：31  
19. 张强，年龄：31  
20. 李林，年龄：33  
21. 钟林，年龄：33  
22. 杨丽，年龄：33  
23. 陈利，年龄：33  
24. 牛建军，年龄：34  
25. 田建华，年龄：37  
26. 杨浩，年龄：38  
27. 闭倩，年龄：41  
28. 李红梅，年龄：41  
29. 安凤英，年龄：41  
30. 吴明，年龄：42  
31. 魏斌，年龄：42  
32. 吴婷，年龄：43  
33. 侯宁，年龄：43  
34. 邓玲，年龄：43  
35. 冉亮，年龄：43  
36. 吴冬梅，年龄：43  
37. 李楠，年龄：43  
38. 郑博，年龄：44  
39. 谢峰，年龄：45  
40. 席杨，年龄：45  
41. 钟丽，年龄：45  
42. 赵金凤，年龄：46  
43. 张海燕，年龄：46  
44. 黄成，年龄：47  
45. 刘雪，年龄：47  
46. 匡想，年龄：48  
47. 杨淑华，年龄：48  
48. 陈辉，年龄：49  
49. 伏柳，年龄：49  
50. 杨玉梅，年龄：49,查询成功完成，已显示解释结果
2025-11-24 10:37:19,789 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 10:37:27,419 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:37:27,423 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 10:37:27,425 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 10:37:27,426 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_102859]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 10:37:31,649 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:37:31,652 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info ci INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(ci.BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND lb.LN_STATUS = '02'
2025-11-24 10:37:31,657 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 10:37:32,078 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:37:32,082 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 10:37:32,087 - __main__ - INFO - 年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 10:38:02,304 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 10:38:05,429 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:38:05,431 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 10:38:05,431 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 10:38:05,431 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_102859]: 给出这四人的名字
2025-11-24 10:38:09,320 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:38:09,326 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info LIMIT 10
2025-11-24 10:38:09,332 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 10:38:09,876 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:38:09,881 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 10:38:09,886 - __main__ - INFO - 这四人的名字是：徐桂香、李林、闭倩、谢峰。,查询成功完成，已显示解释结果
2025-11-24 10:40:12,492 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？给出姓名
2025-11-24 10:40:19,042 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:40:19,042 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 10:40:19,042 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？给出姓名
2025-11-24 10:40:19,043 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_102859]: 年龄在四十岁以上的客户有多少逾期的？给出姓名
2025-11-24 10:40:23,893 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:40:23,899 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NAM FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(customer_info.BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND loan_business.LN_STATUS = '02'
2025-11-24 10:40:23,905 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 10:40:24,632 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:40:24,634 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 10:40:24,636 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有逾期的客户共有4人，他们的姓名分别是：黄成、赵金凤、杨淑华、郑博。,查询成功完成，已显示解释结果
2025-11-24 10:59:04,871 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 10:59:04,871 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 10:59:04,871 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_105904
2025-11-24 10:59:20,815 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 10:59:21,112 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 10:59:21,112 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 10:59:27,115 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:59:27,127 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 10:59:27,127 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 10:59:27,128 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_105904]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 10:59:27,128 - text2sql_module.text2sql_processor - INFO - 使用用户历史记录增强查询: 用户历史问题:
用户: 年龄在四十岁以上的客户有多少逾期的？

当前问题: 年龄在四十岁以上的客户有多少逾期的？...
2025-11-24 10:59:30,727 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:59:30,734 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info ci INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO WHERE YEAR(CURDATE()) - YEAR(ci.BIRTH_DT) > 40 AND lb.LN_STATUS = '02'
2025-11-24 10:59:30,739 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 10:59:31,135 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 10:59:31,139 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 10:59:31,141 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 10:59:56,228 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 11:00:00,564 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:00:00,569 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 11:00:00,569 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 11:00:00,570 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_105904]: 给出这四人的名字
2025-11-24 11:00:00,571 - text2sql_module.text2sql_processor - INFO - 使用用户历史记录增强查询: 用户历史问题:
用户: 年龄在四十岁以上的客户有多少逾期的？
用户: 给出这四人的名字

当前问题: 给出这四人的名字...
2025-11-24 11:00:06,288 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:00:06,294 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NAM FROM customer_info WHERE customer_info.CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1896179073998708285')
2025-11-24 11:00:06,299 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:00:06,756 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:00:06,760 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:00:06,764 - __main__ - INFO - 这四人的名字分别是：徐桂香、李林、闭倩、陈丽丽。,查询成功完成，已显示解释结果
2025-11-24 11:01:45,701 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？给出它们的名字
2025-11-24 11:01:51,396 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:01:51,397 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 11:01:51,397 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？给出它们的名字
2025-11-24 11:01:51,398 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_105904]: 年龄在四十岁以上的客户有多少逾期的？给出它们的名字
2025-11-24 11:01:51,398 - text2sql_module.text2sql_processor - INFO - 使用用户历史记录增强查询: 用户历史问题:
用户: 年龄在四十岁以上的客户有多少逾期的？
用户: 给出这四人的名字
用户: 年龄在四十岁以上的客户有多少逾期的？给出它们的名字

当前问题: 年龄在四十岁以上的客户有多少逾期的？给...
2025-11-24 11:01:55,780 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:01:55,786 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NAM FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE YEAR(CURDATE()) - YEAR(customer_info.BIRTH_DT) > 40 AND loan_business.LN_STATUS = '02'
2025-11-24 11:01:55,788 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:01:56,529 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:01:56,534 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:01:56,539 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的逾期客户有4位，他们的名字分别是：黄成、赵金凤、杨淑华、郑博。,查询成功完成，已显示解释结果
2025-11-24 11:13:08,641 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 11:13:08,641 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 11:13:08,641 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_111308
2025-11-24 11:13:12,336 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:13:12,635 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 11:13:12,635 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 11:13:17,602 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:13:17,614 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 11:13:17,614 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:13:17,615 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_111308]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:13:17,615 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？

                ...
2025-11-24 11:13:17,636 - text2sql_module.text2sql_processor - ERROR - SQL生成失败: 'question'
2025-11-24 11:16:17,673 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 11:16:17,673 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 11:16:17,673 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_111617
2025-11-24 11:16:35,404 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:16:35,707 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 11:16:35,707 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 11:16:40,480 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:16:40,491 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 11:16:40,491 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:16:40,492 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_111617]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:16:40,492 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？

                ...
2025-11-24 11:16:45,218 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:16:45,225 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info WHERE YEAR(CURDATE()) - YEAR(BIRTH_DT) > 40 AND CUST_NO IN (SELECT CUST_NO FROM loan_business WHERE LN_STATUS = '02')
2025-11-24 11:16:45,230 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:16:45,713 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:16:45,714 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:16:45,716 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 11:16:57,611 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 11:17:04,222 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:17:04,225 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 11:17:04,227 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 11:17:04,228 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_111617]: 给出这四人的名字
2025-11-24 11:17:04,229 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 给出这四人的名字
...
2025-11-24 11:17:11,468 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:17:11,470 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info WHERE CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1896179073998708285')
2025-11-24 11:17:11,472 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:17:12,049 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:17:12,053 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:17:12,058 - __main__ - INFO - 这四人的名字分别是：徐桂香、李林、闭倩、陈丽丽。,查询成功完成，已显示解释结果
2025-11-24 11:21:44,101 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 11:21:44,101 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 11:21:44,102 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_112144
2025-11-24 11:21:46,524 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:21:46,822 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 11:21:46,823 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 11:21:50,778 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:21:50,802 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 11:21:50,803 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:21:50,803 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_112144]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 11:21:50,804 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？

                ...
2025-11-24 11:21:55,258 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:21:55,265 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info WHERE YEAR(CURDATE()) - YEAR(BIRTH_DT) > 40 AND CUST_NO IN (SELECT CUST_NO FROM loan_business WHERE LN_STATUS = '02')
2025-11-24 11:21:55,267 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:21:55,861 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:21:55,866 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:21:55,870 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 11:22:01,517 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 11:22:04,476 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:22:04,479 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 11:22:04,481 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 11:22:04,482 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_112144]: 给出这四人的名字
2025-11-24 11:22:04,483 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 给出这四人的名字
...
2025-11-24 11:22:10,805 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:22:10,806 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info WHERE CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1896179073998708285')
2025-11-24 11:22:10,808 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:22:11,433 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:22:11,438 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:22:11,443 - __main__ - INFO - 这四人的名字分别是：徐桂香、李林、闭倩、陈丽丽。,查询成功完成，已显示解释结果
2025-11-24 11:22:36,867 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？给出他们的名字
2025-11-24 11:22:41,963 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:22:41,964 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 11:22:41,964 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？给出他们的名字
2025-11-24 11:22:41,965 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_112144]: 年龄在四十岁以上的客户有多少逾期的？给出他们的名字
2025-11-24 11:22:41,965 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 给出这四人的名字
...
2025-11-24 11:22:46,697 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:22:46,700 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NAM FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(customer_info.BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND loan_business.LN_STATUS = '02'
2025-11-24 11:22:46,703 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 11:22:47,358 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 11:22:47,363 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 11:22:47,367 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的逾期客户有4位，他们的名字分别是：黄成、赵金凤、杨淑华、郑博。,查询成功完成，已显示解释结果
2025-11-24 13:05:23,000 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:05:23,000 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:05:23,000 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_130523
2025-11-24 13:05:26,739 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:05:27,035 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:05:27,035 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:05:32,111 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:05:32,133 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:05:32,133 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:05:32,134 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_130523]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:05:32,135 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        重要提示：请特别注意当前问题与历史问题之间的上下文关联，确保正确理解所有代词的指代关系！
                        
     ...
2025-11-24 13:05:36,235 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:05:36,242 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info WHERE YEAR(CURDATE()) - YEAR(BIRTH_DT) > 40 AND CUST_NO IN (SELECT CUST_NO FROM loan_business WHERE LN_STATUS = '02')
2025-11-24 13:05:36,244 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:05:36,746 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:05:36,747 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:05:36,749 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 13:05:40,465 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 13:05:43,895 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:05:43,897 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 13:05:43,898 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 13:05:43,899 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_130523]: 给出这四人的名字
2025-11-24 13:05:43,900 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        重要提示：请特别注意当前问题与历史问题之间的上下文关联，确保正确理解所有代词的指代关系！
                        
     ...
2025-11-24 13:05:48,476 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:05:48,482 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info WHERE CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1896179073998708285')
2025-11-24 13:05:48,487 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:05:48,998 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:05:49,002 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:05:49,007 - __main__ - INFO - 这四人的名字分别是：徐桂香、李林、闭倩、陈丽丽。,查询成功完成，已显示解释结果
2025-11-24 13:31:27,439 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:31:27,440 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:31:27,440 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_133127
2025-11-24 13:31:31,081 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:31:31,377 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:31:31,377 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:31:39,464 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:31:39,474 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:31:39,474 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:31:39,475 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_133127]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:31:39,475 - text2sql_module.text2sql_processor - INFO - 将结构化对话历史作为上下文提示词传递给大模型: 
                    【重要上下文关联要求】
                    请仔细分析以下完整对话历史，确保正确理解当前问题中的所有代词（如'这'、'他们'、'四人'等）...
2025-11-24 13:31:47,590 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:31:47,595 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT * FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON (deposit_business.PROD_CD = product_info.PROD_CD OR loan_business.PROD_CD = product_info.PROD_CD) WHERE customer_info.CUST_NO = 'C1896179073998708285'
2025-11-24 13:31:47,601 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:31:48,812 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:31:48,817 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:31:48,822 - __main__ - INFO - 根据查询结果，客户“陈丽丽”（CUST_NO: C1896179073998708285）的年龄为1995年8月10日出生，当前年龄为29岁，未满40岁。因此，该客户不符合“年龄在四十岁以上”的条件，也没有逾期记录。,查询成功完成，已显示解释结果
2025-11-24 13:32:20,716 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:32:28,402 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:32:28,403 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:32:28,403 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:32:28,404 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_133127]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:32:28,404 - text2sql_module.text2sql_processor - INFO - 将结构化对话历史作为上下文提示词传递给大模型: 
                    【重要上下文关联要求】
                    请仔细分析以下完整对话历史，确保正确理解当前问题中的所有代词（如'这'、'他们'、'四人'等）...
2025-11-24 13:32:38,455 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:32:38,456 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT * FROM customer_info INNER JOIN deposit_business ON customer_info.CUST_NO = deposit_business.CUST_NO INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO INNER JOIN product_info ON (deposit_business.PROD_CD = product_info.PROD_CD OR loan_business.PROD_CD = product_info.PROD_CD) WHERE customer_info.CUST_NO = 'C1896179073998708285'
2025-11-24 13:32:38,459 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:32:39,630 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:32:39,634 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:32:39,637 - __main__ - INFO - 根据查询结果，客户“陈丽丽”（CUST_NO: C1896179073998708285）年龄为28岁（出生日期为1995年8月10日），未达到四十岁。因此，该客户不符合“年龄在四十岁以上”的条件，也没有逾期记录。,查询成功完成，已显示解释结果
2025-11-24 13:33:09,934 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:33:09,935 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:33:09,935 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_133309
2025-11-24 13:33:13,966 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:33:14,258 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:33:14,258 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:33:20,150 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:33:20,162 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:33:20,162 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:33:20,162 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_133309]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:33:20,163 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？

                ...
2025-11-24 13:33:24,571 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:33:24,578 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND CUST_NO IN (SELECT CUST_NO FROM loan_business WHERE LN_STATUS = '02')
2025-11-24 13:33:24,585 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:33:25,071 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:33:25,074 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:33:25,077 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 13:43:20,649 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:43:20,649 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:43:20,650 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_134320
2025-11-24 13:43:24,561 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:43:24,854 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:43:24,854 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:43:30,299 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:43:30,306 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:43:30,306 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:43:30,307 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_134320]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:43:30,309 - text2sql_module.text2sql_processor - ERROR - 查询处理失败: Completions.create() got an unexpected keyword argument 'prompt'
2025-11-24 13:47:05,284 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:47:05,284 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:47:05,285 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_134705
2025-11-24 13:47:07,509 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:47:07,811 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:47:07,811 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:47:15,288 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:15,296 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:47:15,296 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:47:15,297 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_134705]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:47:15,812 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:15,816 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
                 ...
2025-11-24 13:47:19,178 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:19,184 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_count FROM loan_business WHERE CUST_NO IN (SELECT CUST_NO FROM customer_info WHERE YEAR(CURDATE()) - YEAR(BIRTH_DT) > 40) AND LN_STATUS = '02'
2025-11-24 13:47:19,190 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:47:19,575 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:19,577 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:47:19,579 - __main__ - INFO - 根据查询结果，年龄40岁以上的客户中，逾期的客户数量为4人。,查询成功完成，已显示解释结果
2025-11-24 13:47:30,598 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 13:47:35,026 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:35,030 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 13:47:35,031 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 13:47:35,033 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_134705]: 给出这四人的名字
2025-11-24 13:47:35,380 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:35,386 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 给出这四人的名字
...
2025-11-24 13:47:39,224 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:39,226 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info WHERE CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1896179073998708285')
2025-11-24 13:47:39,227 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:47:39,685 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:47:39,687 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:47:39,689 - __main__ - INFO - 这四人的名字分别是：徐桂香、李林、闭倩、陈丽丽。,查询成功完成，已显示解释结果
2025-11-24 13:51:02,543 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:51:02,544 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:51:02,544 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_135102
2025-11-24 13:51:04,956 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:51:05,253 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:51:05,254 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:51:13,978 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:13,990 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:51:13,990 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:51:13,991 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135102]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:51:14,387 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:14,388 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
                 ...
2025-11-24 13:51:17,851 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:17,853 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_count FROM loan_business WHERE CUST_NO IN (SELECT CUST_NO FROM customer_info WHERE YEAR(CURDATE()) - YEAR(FROM_DATE(BIRTH_DT)) > 40) AND LN_STATUS = '02'
2025-11-24 13:51:17,867 - text2sql_module.text2sql_processor - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1305, 'FUNCTION mysql2.FROM_DATE does not exist')
[SQL: SELECT COUNT(*) AS overdue_count FROM loan_business WHERE CUST_NO IN (SELECT CUST_NO FROM customer_info WHERE YEAR(CURDATE()) - YEAR(FROM_DATE(BIRTH_DT)) > 40) AND LN_STATUS = '02']
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-24 13:51:17,867 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回0行结果
2025-11-24 13:51:17,869 - __main__ - INFO - 查询执行失败：SQL执行失败: (pymysql.err.OperationalError) (1305, 'FUNCTION mysql2.FROM_DATE does not exist')
[SQL: SELECT COUNT(*) AS overdue_count FROM loan_business WHERE CUST_NO IN (SELECT CUST_NO FROM customer_info WHERE YEAR(CURDATE()) - YEAR(FROM_DATE(BIRTH_DT)) > 40) AND LN_STATUS = '02']
(Background on this error at: https://sqlalche.me/e/20/e3q8),查询成功完成，已显示解释结果
2025-11-24 13:51:25,516 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:51:30,275 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:30,278 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:51:30,279 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:51:30,280 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135102]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:51:30,683 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:30,688 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 年龄在四十岁以上的...
2025-11-24 13:51:34,324 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:34,330 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info ci INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(ci.BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND lb.LN_STATUS = '02'
2025-11-24 13:51:34,332 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:51:34,708 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:34,713 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:51:34,718 - __main__ - INFO - 根据查询结果，年龄40岁以上的逾期客户共有4人。,查询成功完成，已显示解释结果
2025-11-24 13:51:50,088 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 13:51:53,024 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:53,027 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 13:51:53,028 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 13:51:53,029 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135102]: 给出这四人的名字
2025-11-24 13:51:53,365 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:53,367 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 年龄在四十岁以上的...
2025-11-24 13:51:59,167 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:59,170 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info WHERE CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1896179073998708285')
2025-11-24 13:51:59,174 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:51:59,563 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:51:59,565 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:51:59,567 - __main__ - INFO - 这四人的名字分别是：徐桂香、李林、闭倩、陈丽丽。,查询成功完成，已显示解释结果
2025-11-24 13:55:10,929 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 13:55:10,929 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 13:55:10,929 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_135510
2025-11-24 13:55:13,448 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:55:13,750 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 13:55:13,751 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 13:55:18,255 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:18,266 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:55:18,267 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:55:18,267 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135510]: 年龄在四十岁以上的客户有多少逾期的？
2025-11-24 13:55:18,732 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:18,733 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
                 ...
2025-11-24 13:55:22,344 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:22,346 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info ci INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(ci.BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND lb.LN_STATUS = '02'
2025-11-24 13:55:22,349 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:55:22,714 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:22,718 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:55:22,721 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有4人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 13:55:29,757 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这四人的名字
2025-11-24 13:55:34,726 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:34,728 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 13:55:34,729 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这四人的名字
2025-11-24 13:55:34,729 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135510]: 给出这四人的名字
2025-11-24 13:55:35,186 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:35,187 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 给出这四人的名字
...
2025-11-24 13:55:38,908 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:38,910 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.CUST_NAM FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(customer_info.BIRTH_DT, '%Y%m%d'), CURDATE()) > 40 AND loan_business.LN_STATUS = '02'
2025-11-24 13:55:38,913 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:55:39,472 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:55:39,474 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:55:39,476 - __main__ - INFO - 根据查询结果，年龄在四十岁以上的客户中，有逾期的共有4人，他们的名字分别是：黄成、赵金凤、杨淑华、郑博。,查询成功完成，已显示解释结果
2025-11-24 13:56:02,301 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 13:56:06,346 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:06,350 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 13:56:06,351 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 13:56:06,352 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135510]: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 13:56:06,737 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:06,739 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在四十岁以上的客户有多少逾期的？
历史问题 2: 给出这四人的名字
...
2025-11-24 13:56:10,287 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:10,290 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info ci INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(ci.BIRTH_DT, '%Y%m%d'), CURDATE()) > 30 AND lb.LN_STATUS = '02';
2025-11-24 13:56:10,293 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:56:10,746 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:10,747 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:56:10,749 - __main__ - INFO - 根据查询结果，年龄在三十岁以上的客户中，有5人存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 13:56:40,229 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这些人的具体信息
2025-11-24 13:56:46,467 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:46,468 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 13:56:46,468 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这些人的具体信息
2025-11-24 13:56:46,469 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_135510]: 给出这些人的具体信息
2025-11-24 13:56:46,954 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:46,958 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 给出这四人的名字
历史问题 2: 年龄在三十岁以上的客户有多少逾期的？
...
2025-11-24 13:56:50,752 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:50,757 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.* FROM customer_info INNER JOIN loan_business ON customer_info.CUST_NO = loan_business.CUST_NO WHERE TIMESTAMPDIFF(YEAR, STR_TO_DATE(customer_info.BIRTH_DT, '%Y%m%d'), CURDATE()) > 30 AND loan_business.LN_STATUS = '02'
2025-11-24 13:56:50,762 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 13:56:52,519 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 13:56:52,524 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 13:56:52,528 - __main__ - INFO - 根据查询结果，年龄在三十岁以上的客户中，有1行数据存在逾期情况。以下是这些客户的详细信息：

1. **客户编号**：C6382141273297107061  
   **姓名**：黄成  
   **身份证号**：430426********2698  
   **出生日期**：1978年1月18日  
   **联系方式**：18*****7304  
   **地址**：新疆维吾尔自治区磊市丰都李路D座 548281  

其他客户虽然年龄超过30岁，但未显示逾期记录。,查询成功完成，已显示解释结果
2025-11-24 14:01:51,108 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 14:01:51,108 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 14:01:51,109 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_140151
2025-11-24 14:01:56,744 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 14:01:57,050 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 14:01:57,050 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 14:02:02,295 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:02,301 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 14:02:02,302 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 14:02:02,302 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140151]: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 14:02:02,795 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:02,797 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在三十岁以上的客户有多少逾期的？
                 ...
2025-11-24 14:02:07,050 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:07,052 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_customer_count FROM customer_info WHERE YEAR(CURDATE()) - YEAR(BIRTH_DT) > 30 AND CUST_NO IN (SELECT CUST_NO FROM loan_business WHERE LN_STATUS = '02')
2025-11-24 14:02:07,054 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:02:07,460 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:07,461 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:02:07,463 - __main__ - INFO - 根据查询结果，年龄在三十岁以上的客户中，有5位存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 14:02:31,389 - base_agent.simple_agent_manager - INFO - 处理查询: 这五位的电话号码是多少
2025-11-24 14:02:36,502 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:36,503 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 14:02:36,503 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 这五位的电话号码是多少
2025-11-24 14:02:36,503 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140151]: 这五位的电话号码是多少
2025-11-24 14:02:36,938 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:36,939 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在三十岁以上的客户有多少逾期的？
历史问题 2: 这五位的电话号码是...
2025-11-24 14:02:42,502 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:42,504 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT customer_info.MOBILE_N FROM customer_info WHERE customer_info.CUST_NO IN ('C1024679213467600282', 'C1126124671950375198', 'C1178779231191697253', 'C1740778069171352050', 'C6382141273297107061')
2025-11-24 14:02:42,506 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:02:43,256 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:02:43,260 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:02:43,261 - __main__ - INFO - 这五位的电话号码分别是：  
17*****4241  
18*****4993  
13*****3068  
18*****8994  
18*****7304,查询成功完成，已显示解释结果
2025-11-24 14:05:16,502 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 14:05:16,502 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 14:05:16,502 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_140516
2025-11-24 14:05:19,984 - base_agent.simple_agent_manager - INFO - 处理查询: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 14:05:20,288 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 14:05:20,289 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 14:05:25,025 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:05:25,036 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 14:05:25,036 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 14:05:25,037 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140516]: 年龄在三十岁以上的客户有多少逾期的？
2025-11-24 14:05:25,777 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:05:25,781 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在三十岁以上的客户有多少逾期的？
                 ...
2025-11-24 14:05:44,052 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:05:44,056 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS overdue_count FROM customer_info c INNER JOIN loan_business l ON c.CUST_NO = l.CUST_NO WHERE (2023 - CAST(SUBSTR(c.BIRTH_DT, 1, 4) AS UNSIGNED)) > 30 AND l.OVERDUE_DAYS > 0;
2025-11-24 14:05:44,061 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:05:44,782 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:05:44,787 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:05:44,789 - __main__ - INFO - 年龄在三十岁以上的客户中，有5位存在逾期情况。,查询成功完成，已显示解释结果
2025-11-24 14:05:51,924 - base_agent.simple_agent_manager - INFO - 处理查询: 给出这些人的具体信息
2025-11-24 14:05:58,177 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:05:58,180 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 14:05:58,181 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 给出这些人的具体信息
2025-11-24 14:05:58,182 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140516]: 给出这些人的具体信息
2025-11-24 14:05:58,800 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:05:58,805 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在三十岁以上的客户有多少逾期的？
历史问题 2: 给出这些人的具体信...
2025-11-24 14:06:18,533 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:06:18,539 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ci.*, db.ACCT_NO, db.CUR_BAL, db.FIX_BAL, db.MTH_AVG_BAL, lb.DUE_BILL_NO, lb.LN_ACCT_NO, lb.LN_BAL, lb.CONT_AMT, lb.DISB_DT, lb.MATURITY_DT, lb.OVERDUE_DAYS, lb.MTH_DUE_AMT, pi.PROD_NAM, pi.EXP_YR_RATE 
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
INNER JOIN product_info pi ON lb.PROD_CD = pi.PROD_CD
LEFT JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
WHERE lb.OVERDUE_DAYS > 0 
  AND (2025 - CAST(SUBSTR(ci.BIRTH_DT, 1, 4) AS UNSIGNED)) > 30
2025-11-24 14:06:18,543 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:07:05,721 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:07:05,723 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:07:05,725 - __main__ - INFO - 根据查询结果，年龄在三十岁以上的逾期客户共有5位，以下是他们的详细信息：

---

### **1. 黄成**
- **客户编号**: C6382141273297107061
- **性别**: 男
- **出生日期**: 1978年1月18日（现年约47岁）
- **身份证号**: 430426********2698
- **联系电话**: 18*****7304
- **住址**: 新疆维吾尔自治区磊市丰都李路D座 548281
- **贷款信息**:
  - 贷款账号: LN20241811254162191974
  - 贷款余额: 332,151.84元
  - 合同金额: 708,436.57元
  - 放款日期: 2025年3月23日
  - 到期日期: 2052年3月20日
  - **逾期天数**: 93天
  - 本月应还: 1,660.76元
  - 贷款产品: 个人消费贷款（年利率6.8%）
- **存款账户**:
  - 账号1: 6222020856214164793，活期余额0.00元，定期余额996,595.87元
  - 账号2: 6222026062420898992，活期余额0.00元，定期余额572,694.86元

---

### **2. 赵金凤**
- **客户编号**: C2483347477109433712
- **性别**: 女
- **出生日期**: 1979年10月31日（现年约45岁）
- **身份证号**: 513426********5454
- **联系电话**: 15*****7622
- **住址**: 新疆维吾尔自治区鹏市合川韩街r座 447710
- **贷款信息**:
  - 贷款账号: LN20242638681038605753
  - 贷款余额: 835,330.77元
  - 合同金额: 1,342,748.79元
  - 放款日期: 2024年2月9日
  - 到期日期: 2030年3月28日
  - **逾期天数**: 163天
  - 本月应还: 4,176.65元
  - 贷款产品: 旧版消费贷（年利率7.2%）
- **存款账户**:
  - 账号1: 6222027832789280963，活期余额0.00元，定期余额775,321.90元
  - 账号2: 6222028757568393494，活期余额0.00元，定期余额952,828.23元

---

### **3. 杨淑华**
- **客户编号**: C8469233472095616891
- **性别**: 男
- **出生日期**: 1977年3月21日（现年约48岁）
- **身份证号**: 211381********1823
- **联系电话**: 17*****5059
- **住址**: 青海省淮安县城东金街e座 318644
- **贷款信息**:
  - 贷款账号: LN20246035584324041928
  - 贷款余额: 343,608.11元
  - 合同金额: 859,030.64元
  - 放款日期: 2025年8月12日
  - 到期日期: 2048年10月9日
  - **逾期天数**: 66天
  - 本月应还: 1,718.04元
  - 贷款产品: 旧版消费贷（年利率7.2%）
- **存款账户**:
  - 账号: 6222022458935373590，活期余额0.00元，定期余额669,134.57元

---

### **4. 田建华**
- **客户编号**: C5978506504041139122
- **性别**: 女
- **出生日期**: 1988年9月14日（现年约36岁）
- **证件号**: E90161060
- **联系电话**: 15*****3527
- **住址**: 安徽省潜江市朝阳潜江路o座 847359
- **贷款信息**:
  - 贷款账号: LN20247392700449046214
  - 贷款余额: 13,261.26元
  - 合同金额: 19,689.98元
  - 放款日期: 2023年6月22日
  - 到期日期: 2038年5月16日
  - **逾期天数**: 82天
  - 本月应还: 66.31元
  - 贷款产品: 旧版消费贷（年利率7.2%）
- **存款账户**:
  - 账号1: 6222027331422836981，活期余额32,089.10元，定期余额0.00元
  - 账号2: 6222028421223421834，活期余额0.00元，定期余额809,118.36元
  - 账号3: 6222029058068716010，活期余额35,299.33元，定期余额0.00元

---

### **5. 郑博**
- **客户编号**: C3252323796025610208
- **性别**: 男
- **出生日期**: 1981年11月4日（现年约43岁）
- **证件号**: E32814819
- **联系电话**: 17*****2293
- **住址**: 福建省建市普陀刘街s座 717594
- **贷款信息**:
  - 贷款账号: LN20247527944550419359
  - 贷款余额: 633,099.30元
  - 合同金额: 1,032,120.84元
  - 放款日期: 2024年7月28日
  - 到期日期: 2033年5月11日
  - **逾期天数**: 3天
  - 本月应还: 3,165.50元
  - 贷款产品: 个人消费贷款（年利率6.8%）
- **存款账户**:
  - 账号1: 6222024253388215356，活期余额0.00元，定期余额362,020.24元
  - 账号2: 6222028728175919296，活期余额0.00元，定期余额900,806.69元

---

以上为所有年龄超过30岁的逾期客户的完整信息。,查询成功完成，已显示解释结果
2025-11-24 14:11:28,149 - base_agent.simple_agent_manager - INFO - 处理查询: 这些人中本月应还贷款最多的是哪个？
2025-11-24 14:11:33,184 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:11:33,186 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 14:11:33,187 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 这些人中本月应还贷款最多的是哪个？
2025-11-24 14:11:33,188 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140516]: 这些人中本月应还贷款最多的是哪个？
2025-11-24 14:11:34,402 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:11:34,405 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 年龄在三十岁以上的客户有多少逾期的？
历史问题 2: 给出这些人的具体信...
2025-11-24 14:11:45,013 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:11:45,017 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ci.CUST_NAM, lb.MTH_DUE_AMT 
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.OVERDUE_DAYS > 0 
  AND (2025 - CAST(SUBSTR(ci.BIRTH_DT, 1, 4) AS UNSIGNED)) > 30
ORDER BY lb.MTH_DUE_AMT DESC
LIMIT 1;
2025-11-24 14:11:45,022 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:11:46,339 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:11:46,341 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:11:46,343 - __main__ - INFO - 在年龄三十岁以上的逾期客户中，本月应还贷款最多的是赵金凤，其本月应还金额为4176.65元。,查询成功完成，已显示解释结果
2025-11-24 14:17:08,386 - base_agent.simple_agent_manager - INFO - 处理查询: 所有客户中使用美元存款的客户有多少人？
2025-11-24 14:17:16,161 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:17:16,162 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 14:17:16,163 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 所有客户中使用美元存款的客户有多少人？
2025-11-24 14:17:16,163 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140516]: 所有客户中使用美元存款的客户有多少人？
2025-11-24 14:17:17,057 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:17:17,059 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 给出这些人的具体信息
历史问题 2: 这些人中本月应还贷款最多的是哪个？...
2025-11-24 14:17:20,911 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:17:20,913 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(DISTINCT CUST_NO) AS customer_count FROM deposit_business WHERE CCY_CD = 'USD';
2025-11-24 14:17:20,917 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:17:21,574 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:17:21,575 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:17:21,577 - __main__ - INFO - 所有客户中使用美元存款的客户共有23人。,查询成功完成，已显示解释结果
2025-11-24 14:18:02,185 - base_agent.simple_agent_manager - INFO - 处理查询: 除了美元还有哪些货币类型？
2025-11-24 14:18:06,128 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:18:06,129 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 14:18:06,129 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 除了美元还有哪些货币类型？
2025-11-24 14:18:06,129 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140516]: 除了美元还有哪些货币类型？
2025-11-24 14:18:07,128 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:18:07,129 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 这些人中本月应还贷款最多的是哪个？
历史问题 2: 所有客户中使用美元存...
2025-11-24 14:18:16,290 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:18:16,296 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT DISTINCT CCY_CD FROM deposit_business WHERE CCY_CD != 'USD';
2025-11-24 14:18:16,301 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:18:17,387 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:18:17,390 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:18:17,394 - __main__ - INFO - 除了美元存款外，客户还使用了以下货币类型：CNY（人民币）和 EUR（欧元）。,查询成功完成，已显示解释结果
2025-11-24 14:19:12,271 - base_agent.simple_agent_manager - INFO - 处理查询: 所有客户中哪位客户存款最多？
2025-11-24 14:19:18,266 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:19:18,270 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 14:19:18,271 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 所有客户中哪位客户存款最多？
2025-11-24 14:19:18,272 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_140516]: 所有客户中哪位客户存款最多？
2025-11-24 14:19:19,358 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:19:19,360 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 所有客户中使用美元存款的客户有多少人？
历史问题 2: 除了美元还有哪些...
2025-11-24 14:19:26,241 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:19:26,247 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, (db.CUR_BAL + db.FIX_BAL) AS total_deposit FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO ORDER BY total_deposit DESC LIMIT 1;
2025-11-24 14:19:26,249 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:19:27,803 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:19:27,808 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:19:27,810 - __main__ - INFO - 存款最多的客户是黄成（客户号：C6382141273297107061），其存款总额为996,595.87元。,查询成功完成，已显示解释结果
2025-11-24 14:44:45,279 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 14:44:45,279 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 14:44:45,279 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_144445
2025-11-24 14:44:51,755 - base_agent.simple_agent_manager - INFO - 处理查询: 所有客户中哪位客户存款最多？
2025-11-24 14:44:52,061 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 14:44:52,062 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 14:44:55,520 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:44:55,531 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 14:44:55,531 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 所有客户中哪位客户存款最多？
2025-11-24 14:44:55,532 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_144445]: 所有客户中哪位客户存款最多？
2025-11-24 14:44:56,183 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:44:56,188 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 所有客户中哪位客户存款最多？
                     ...
2025-11-24 14:45:07,595 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:45:07,596 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * 7 / 0.9 ELSE 0 END) AS total_deposit_cny 
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
GROUP BY ci.CUST_NO, ci.CUST_NAM
ORDER BY total_deposit_cny DESC
LIMIT 1;
2025-11-24 14:45:07,604 - text2sql_module.text2sql_processor - ERROR - SQL优化失败: Expected a Runnable, callable or dict.Instead got an unsupported type: <class 'langchain_core.prompt_values.StringPromptValue'>
2025-11-24 14:45:07,609 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:45:09,644 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:45:09,648 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:45:09,651 - __main__ - INFO - 所有客户中存款最多的客户是赵金凤（客户号：C2483347477109433712），其存款总额折合人民币约为13,441,167.68元。,查询成功完成，已显示解释结果
2025-11-24 14:53:13,207 - base_agent.simple_agent_manager - INFO - 处理查询: 赵金凤有几个账户，请给出账户号
2025-11-24 14:53:23,910 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:53:23,910 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 14:53:23,912 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 赵金凤有几个账户，请给出账户号
2025-11-24 14:53:23,912 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_144445]: 赵金凤有几个账户，请给出账户号
2025-11-24 14:53:24,688 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:53:24,693 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 所有客户中哪位客户存款最多？
历史问题 2: 赵金凤有几个账户，请给出账...
2025-11-24 14:53:31,791 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:53:31,793 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS account_count, GROUP_CONCAT(ACCT_NO) AS account_numbers FROM deposit_business WHERE CUST_NO = (SELECT CUST_NO FROM customer_info WHERE CUST_NAM = '赵金凤');
2025-11-24 14:53:31,799 - text2sql_module.text2sql_processor - ERROR - SQL优化失败: Expected a Runnable, callable or dict.Instead got an unsupported type: <class 'langchain_core.prompt_values.StringPromptValue'>
2025-11-24 14:53:31,804 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:53:33,555 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:53:33,559 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:53:33,563 - __main__ - INFO - 赵金凤有2个账户，账户号分别为：6222027832789280963 和 6222028757568393494。,查询成功完成，已显示解释结果
2025-11-24 14:59:07,147 - base_agent.simple_agent_manager - INFO - 处理查询: 李林的一共有多少存款？
2025-11-24 14:59:15,160 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:59:15,161 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 14:59:15,161 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 李林的一共有多少存款？
2025-11-24 14:59:15,162 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_144445]: 李林的一共有多少存款？
2025-11-24 14:59:17,625 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:59:17,629 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 所有客户中哪位客户存款最多？
历史问题 2: 赵金凤有几个账户，请给出账...
2025-11-24 14:59:29,422 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:59:29,423 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT SUM(d.CUR_BAL + d.FIX_BAL) AS total_deposit_cny
FROM deposit_business d
INNER JOIN customer_info c ON d.CUST_NO = c.CUST_NO
WHERE c.CUST_NAM = '李林';
2025-11-24 14:59:29,430 - text2sql_module.text2sql_processor - ERROR - SQL优化失败: Expected a Runnable, callable or dict.Instead got an unsupported type: <class 'langchain_core.prompt_values.StringPromptValue'>
2025-11-24 14:59:29,432 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 14:59:30,174 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:59:30,179 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 14:59:30,184 - __main__ - INFO - 李林的存款总额为282,887.42元。,查询成功完成，已显示解释结果
2025-11-24 15:01:44,598 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:01:53,955 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:01:53,958 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 15:01:53,960 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:01:53,961 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_144445]: 客户C8821725552828636911有多少存款？
2025-11-24 15:01:54,898 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:01:54,901 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 赵金凤有几个账户，请给出账户号
历史问题 2: 李林的一共有多少存款？
...
2025-11-24 15:02:05,200 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:02:05,203 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT SUM(CASE WHEN d.CCY_CD = 'CNY' THEN d.CUR_BAL + d.FIX_BAL WHEN d.CCY_CD = 'USD' THEN (d.CUR_BAL + d.FIX_BAL) * 7 WHEN d.CCY_CD = 'EUR' THEN (d.CUR_BAL + d.FIX_BAL) * 0.9 * 7 ELSE 0 END) AS total_deposit_cny FROM deposit_business d WHERE d.CUST_NO = 'C8821725552828636911';
2025-11-24 15:02:05,218 - text2sql_module.text2sql_processor - ERROR - SQL优化失败: Expected a Runnable, callable or dict.Instead got an unsupported type: <class 'langchain_core.prompt_values.StringPromptValue'>
2025-11-24 15:02:05,220 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:02:07,512 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:02:07,514 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:02:07,516 - __main__ - INFO - 客户C8821725552828636911的存款总额为3,400,570.94元人民币（已折算）。,查询成功完成，已显示解释结果
2025-11-24 15:14:51,038 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 15:14:51,039 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 15:14:51,039 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_151451
2025-11-24 15:14:53,436 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:14:53,734 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 15:14:53,734 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 15:15:02,957 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:15:02,964 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 15:15:02,964 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:15:02,965 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_151451]: 客户C8821725552828636911有多少存款？
2025-11-24 15:15:03,757 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:15:03,763 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有多少存款？
       ...
2025-11-24 15:15:09,330 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:15:09,331 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT SUM(CUR_BAL + FIX_BAL) AS total_deposit FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:15:09,338 - text2sql_module.text2sql_processor - ERROR - SQL优化失败: Expected a Runnable, callable or dict.Instead got an unsupported type: <class 'langchain_core.prompt_values.StringPromptValue'>
2025-11-24 15:15:09,340 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:15:10,676 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:15:10,677 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:15:10,678 - __main__ - INFO - 客户C8821725552828636911的存款总额为1,218,259.32元人民币。,查询成功完成，已显示解释结果
2025-11-24 15:18:43,831 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 15:18:43,831 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 15:18:43,831 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_151843
2025-11-24 15:18:47,841 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:18:48,140 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 15:18:48,140 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 15:18:54,221 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:18:54,248 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 15:18:54,248 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:18:54,249 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_151843]: 客户C8821725552828636911有多少存款？
2025-11-24 15:18:55,211 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:18:55,217 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有多少存款？
       ...
2025-11-24 15:19:08,877 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:19:08,879 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT SUM(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7 ELSE (CUR_BAL + FIX_BAL) * 7 / 0.9 END) AS total_deposit_cny FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:19:13,996 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:19:13,997 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT 
    COALESCE(SUM(
        CASE 
            WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL
            WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7
            WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * 7 / 0.9
            ELSE 0 
        END
    ), 0) AS total_deposit_cny
FROM 
    deposit_business db
INNER JOIN 
    customer_info ci 
    ON db.CUST_NO = ci.CUST_NO
WHERE 
    db.CUST_NO = 'C8821725552828636911'
    AND db.ACCT_STATUS NOT IN ('9') 
    AND ci.CUST_STATUS NOT IN ('1', '9');
2025-11-24 15:19:13,999 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:19:17,126 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:19:17,127 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:19:17,129 - __main__ - INFO - 客户C8821725552828636911的存款总额为0.00元人民币。  
根据查询条件，该客户名下无有效存款账户（或账户余额为零），因此总存款金额为0。,查询成功完成，已显示解释结果
2025-11-24 15:21:49,463 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 15:21:49,464 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 15:21:49,464 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_152149
2025-11-24 15:21:52,575 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:21:52,878 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 15:21:52,878 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 15:21:58,882 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:21:58,889 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 15:21:58,889 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:21:58,889 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_152149]: 客户C8821725552828636911有多少存款？
2025-11-24 15:21:59,593 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:21:59,595 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有多少存款？
       ...
2025-11-24 15:22:05,958 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:22:05,963 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT SUM(CUR_BAL + FIX_BAL) AS total_deposit FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:22:05,984 - text2sql_module.text2sql_processor - ERROR - SQL优化失败: Expected a Runnable, callable or dict.Instead got an unsupported type: <class 'langchain_core.prompt_values.StringPromptValue'>
2025-11-24 15:22:05,989 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:22:07,173 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:22:07,175 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:22:07,177 - __main__ - INFO - 客户C8821725552828636911的存款总额为1,218,259.32元。,查询成功完成，已显示解释结果
2025-11-24 15:23:14,761 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 15:23:14,762 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 15:23:14,762 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_152314
2025-11-24 15:23:16,099 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:23:16,408 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 15:23:16,409 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 15:23:21,272 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:23:21,296 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 15:23:21,298 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有多少存款？
2025-11-24 15:23:21,298 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_152314]: 客户C8821725552828636911有多少存款？
2025-11-24 15:23:22,136 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:23:22,140 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有多少存款？
       ...
2025-11-24 15:23:35,150 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:23:35,157 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT SUM(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7 ELSE (CUR_BAL + FIX_BAL) * 7 / 0.9 END) AS total_deposit_cny FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:23:41,716 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:23:41,719 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT SUM(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7 ELSE (CUR_BAL + FIX_BAL) * 7 / 0.9 END) AS total_deposit_cny FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:23:41,725 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:23:43,314 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:23:43,318 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:23:43,323 - __main__ - INFO - 客户C8821725552828636911的存款总额为4,009,056.15元人民币（已折算）。,查询成功完成，已显示解释结果
2025-11-24 15:32:36,355 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 15:32:36,355 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 15:32:36,356 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_153236
2025-11-24 15:32:58,376 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有几个账户？列出账户名
2025-11-24 15:32:58,677 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 15:32:58,678 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 15:33:06,012 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:06,035 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 15:33:06,036 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有几个账户？列出账户名
2025-11-24 15:33:06,036 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_153236]: 客户C8821725552828636911有几个账户？列出账户名
2025-11-24 15:33:07,213 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:07,215 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有几个账户？列出账户名
  ...
2025-11-24 15:33:15,614 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:15,617 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS account_count, GROUP_CONCAT(p.PROD_NAM) AS account_names FROM deposit_business d INNER JOIN product_info p ON d.PROD_CD = p.PROD_CD WHERE d.CUST_NO = 'C8821725552828636911';
2025-11-24 15:33:16,774 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:16,778 - text2sql_module.text2sql_processor - WARNING - LLM验证结果解析失败，使用基础验证结果
2025-11-24 15:33:19,379 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:19,380 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT COUNT(*) AS account_count, GROUP_CONCAT(p.PROD_NAM) AS account_names FROM deposit_business d INNER JOIN product_info p ON d.PROD_CD = p.PROD_CD WHERE d.CUST_NO = 'C8821725552828636911';
2025-11-24 15:33:21,329 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:21,330 - text2sql_module.text2sql_processor - WARNING - LLM验证结果解析失败，使用基础验证结果
2025-11-24 15:33:21,332 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:33:24,864 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:33:24,869 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:33:24,873 - __main__ - INFO - 客户C8821725552828636911共有2个账户，账户名称分别为：1年定期存款、3年定期存款。,查询成功完成，已显示解释结果
2025-11-24 15:37:56,595 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有几个账户？列出账户号
2025-11-24 15:38:03,309 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:03,310 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 15:38:03,310 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有几个账户？列出账户号
2025-11-24 15:38:03,310 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_153236]: 客户C8821725552828636911有几个账户？列出账户号
2025-11-24 15:38:04,329 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:04,331 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有几个账户？列出账户名
历史...
2025-11-24 15:38:10,120 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:10,121 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ACCT_NO FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:38:11,604 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:11,608 - text2sql_module.text2sql_processor - WARNING - LLM验证结果解析失败，使用基础验证结果
2025-11-24 15:38:14,208 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:14,209 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT ACCT_NO FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:38:15,085 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:15,089 - text2sql_module.text2sql_processor - WARNING - LLM验证结果解析失败，使用基础验证结果
2025-11-24 15:38:15,094 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:38:18,406 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:38:18,408 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:38:18,409 - __main__ - INFO - 客户C8821725552828636911共有2个账户，账户号分别为：6222024692334560036 和 6222026114606812263。,查询成功完成，已显示解释结果
2025-11-24 15:43:34,200 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 15:43:34,200 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 15:43:34,200 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_154334
2025-11-24 15:43:36,688 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911有几个账户？列出账户号
2025-11-24 15:43:36,982 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 15:43:36,982 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 15:43:45,324 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:45,331 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 15:43:45,331 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911有几个账户？列出账户号
2025-11-24 15:43:45,331 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_154334]: 客户C8821725552828636911有几个账户？列出账户号
2025-11-24 15:43:46,318 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:46,320 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有几个账户？列出账户号
  ...
2025-11-24 15:43:55,117 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:55,120 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS account_count, GROUP_CONCAT(ACCT_NO) AS account_numbers FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:43:55,681 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:58,924 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:58,928 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT COUNT(*) AS account_count, GROUP_CONCAT(ACCT_NO) AS account_numbers FROM deposit_business WHERE CUST_NO = 'C8821725552828636911';
2025-11-24 15:44:00,006 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:44:00,010 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:44:02,072 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:44:02,074 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:44:02,078 - __main__ - INFO - 客户C8821725552828636911共有2个账户，账号分别为：6222024692334560036 和 6222026114606812263。,查询成功完成，已显示解释结果
2025-11-24 15:45:50,819 - base_agent.simple_agent_manager - INFO - 处理查询: 客户C8821725552828636911最后交易日期是什么时间？
2025-11-24 15:45:55,719 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:45:55,723 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_retrieval
2025-11-24 15:45:55,725 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户C8821725552828636911最后交易日期是什么时间？
2025-11-24 15:45:55,726 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_154334]: 客户C8821725552828636911最后交易日期是什么时间？
2025-11-24 15:45:57,310 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:45:57,314 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户C8821725552828636911有几个账户？列出账户号
历史...
2025-11-24 15:46:04,763 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:46:04,765 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ACCT_NO AS 账户号, LAST_TRN_DT AS 交易日期 FROM deposit_business WHERE CUST_NO = 'C8821725552828636911' ORDER BY LAST_TRN_DT DESC
2025-11-24 15:46:05,440 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:46:07,142 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:46:07,143 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT ACCT_NO AS 账户号, LAST_TRN_DT AS 交易日期 
FROM deposit_business 
WHERE CUST_NO = 'C8821725552828636911' 
ORDER BY LAST_TRN_DT DESC;
2025-11-24 15:46:07,744 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:46:07,746 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 15:46:10,443 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:46:10,444 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 15:46:10,446 - __main__ - INFO - 客户C8821725552828636911有两个账户，其最后交易日期如下：

- 账户号 6222024692334560036 的最后交易日期为 2025年3月12日。
- 账户号 6222026114606812263 的最后交易日期为 2023年11月27日。,查询成功完成，已显示解释结果
2025-11-24 16:25:41,145 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 16:25:41,145 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 16:25:41,146 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_162541
2025-11-24 16:26:03,636 - base_agent.simple_agent_manager - INFO - 处理查询: 客户中有多少男人？
2025-11-24 16:26:04,519 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 16:26:04,519 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 16:26:12,353 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:12,364 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 16:26:12,364 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户中有多少男人？
2025-11-24 16:26:12,365 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_162541]: 客户中有多少男人？
2025-11-24 16:26:12,871 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:12,872 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中有多少男人？
                        
 ...
2025-11-24 16:26:15,947 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:15,953 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS male_count FROM customer_info WHERE GENDER = '1';
2025-11-24 16:26:16,406 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:17,310 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:17,312 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT COUNT(*) AS male_count FROM customer_info WHERE GENDER = '1';
2025-11-24 16:26:18,152 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:18,160 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 16:26:18,944 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:26:18,946 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 16:26:18,948 - __main__ - INFO - 客户中男性的人数为24人。,查询成功完成，已显示解释结果
2025-11-24 16:35:51,519 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 16:35:51,519 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 16:35:51,519 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_163551
2025-11-24 16:35:55,770 - base_agent.simple_agent_manager - INFO - 处理查询: 客户中有多少男人？
2025-11-24 16:35:56,669 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 16:35:56,670 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 16:36:03,597 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:03,604 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_count
2025-11-24 16:36:03,604 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户中有多少男人？
2025-11-24 16:36:03,604 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_163551]: 客户中有多少男人？
2025-11-24 16:36:04,180 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:04,182 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中有多少男人？
                        
 ...
2025-11-24 16:36:08,401 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:08,408 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT COUNT(*) AS male_count FROM customer_info WHERE GENDER = '1';
2025-11-24 16:36:09,216 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:10,161 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:10,164 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT COUNT(*) AS male_count FROM customer_info WHERE GENDER = '1';
2025-11-24 16:36:10,744 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:10,746 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 16:36:11,526 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:36:11,529 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 16:36:11,531 - __main__ - INFO - 客户中有24位男性。,查询成功完成，已显示解释结果
2025-11-24 16:41:20,364 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 16:41:20,364 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 16:41:20,365 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_164120
2025-11-24 16:41:42,796 - base_agent.simple_agent_manager - INFO - 处理查询: 客户中存款最少的是谁？有多少钱？
2025-11-24 16:41:43,670 - utils.llm_client - INFO - LLM客户端初始化完成，模型: qwen-plus
2025-11-24 16:41:43,670 - utils.llm_client - INFO - 使用.env文件配置
2025-11-24 16:41:48,917 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:41:48,925 - base_agent.simple_agent_manager - INFO - 解析意图成功: data_ranking
2025-11-24 16:41:48,925 - base_agent.simple_agent_manager - INFO - 使用Text2SQL处理数据查询: 客户中存款最少的是谁？有多少钱？
2025-11-24 16:41:48,926 - text2sql_module.text2sql_processor - INFO - 处理查询 [cli_session_20251124_164120]: 客户中存款最少的是谁？有多少钱？
2025-11-24 16:41:49,702 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:41:49,708 - text2sql_module.text2sql_processor - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中存款最少的是谁？有多少钱？
                   ...
2025-11-24 16:42:04,721 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:42:04,727 - text2sql_module.text2sql_processor - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * 7 / 0.9 END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_STATUS = '0' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny ASC LIMIT 1;
2025-11-24 16:42:05,503 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:42:08,885 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:42:08,886 - text2sql_module.text2sql_processor - INFO - 优化后的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * 7 / 0.9 END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_STATUS = '0' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny ASC LIMIT 1;
2025-11-24 16:42:10,601 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:42:10,611 - text2sql_module.text2sql_processor - INFO - SQL执行成功，返回1行结果
2025-11-24 16:42:11,641 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 16:42:11,645 - text2sql_module.text2sql_processor - INFO - 查询处理成功，返回1行结果
2025-11-24 16:42:11,649 - __main__ - INFO - 客户中存款最少的是陈辉，他的存款总额为34,403.99元人民币。,查询成功完成，已显示解释结果
2025-11-24 17:07:30,545 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:07:30,545 - __main__ - INFO - 使用封装的日志系统初始化完成
2025-11-24 17:07:30,546 - base_agent.simple_agent_manager - INFO - 创建新会话: cli_session_20251124_170730
2025-11-24 17:18:29,200 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:18:29,227 - __main__ - INFO - ✅ 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:18:32,340 - text2sql_module.text2sql_processor - INFO - 数据库连接初始化成功
2025-11-24 17:18:34,683 - text2sql_module.text2sql_processor - INFO - 语言模型初始化成功
2025-11-24 17:18:34,686 - text2sql_module.text2sql_processor - INFO - SQL处理链初始化成功
2025-11-24 17:18:34,686 - text2sql_module.text2sql_processor - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:18:34,698 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:18:34,889 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:18:34,890 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:18:34,890 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:18:34,907 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:18:34,907 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:18:34,967 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:18:34,967 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:18:34,968 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:18:34,982 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:18:34,983 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:18:34,998 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [session_1]: 查询所有用户的姓名和邮箱
2025-11-24 17:18:35,002 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:18:35,003 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:18:35,003 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:20:36,430 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:20:36,431 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:20:36,598 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,599 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,599 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:20:36,614 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:20:36,615 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:20:36,622 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,623 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,623 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:20:36,634 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,634 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,635 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:20:36,646 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,646 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,646 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:20:36,659 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,659 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,659 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:20:36,670 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,671 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,671 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:20:36,681 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,682 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,682 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:20:36,694 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:20:36,694 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:20:36,694 - text2sql_module.text2sql_processor_langgraph - ERROR - 提示词初始化失败: name 'ChatPromptTemplate' is not defined
2025-11-24 17:22:14,127 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:22:14,128 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:22:14,297 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,298 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,299 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,314 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,314 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,322 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,322 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,323 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,338 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,338 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,340 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:22:14,342 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:22:14,342 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:22:14,343 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:22:14,347 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,347 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,348 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,365 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,365 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,366 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:22:14,368 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:22:14,369 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:22:14,369 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:22:14,372 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,373 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,374 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,389 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,390 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,392 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:22:14,392 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:22:14,395 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,395 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,396 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,412 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,412 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,413 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:22:14,414 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:22:14,415 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:22:14,416 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:22:14,416 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:22:14,417 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:22:14,420 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,420 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,421 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,437 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,438 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,439 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:22:14,442 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:22:14,442 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:22:14,443 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:22:14,446 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,446 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,447 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,463 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,463 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,465 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:22:14,467 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:22:14,467 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:22:14,467 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:22:14,472 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:22:14,473 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:22:14,474 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:22:14,492 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:22:14,492 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:22:14,494 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:22:14,495 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:22:14,496 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:22:14,496 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:24:27,130 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:24:27,132 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:24:27,328 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,329 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,329 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,346 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,346 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,355 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,356 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,357 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,376 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,377 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,378 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:24:27,381 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:24:27,382 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:24:27,382 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:24:27,387 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,387 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,387 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,404 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,404 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,406 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:24:27,409 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:24:27,410 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:24:27,411 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:24:27,413 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,414 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,415 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,431 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,431 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,432 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:24:27,433 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:24:27,435 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,436 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,436 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,454 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,454 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,456 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:24:27,457 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:24:27,457 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:24:27,458 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:24:27,459 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:24:27,459 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:24:27,463 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,463 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,464 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,479 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,481 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,482 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:24:27,483 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:24:27,483 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:24:27,484 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:24:27,488 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,488 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,489 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,504 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,504 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,506 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:24:27,508 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:24:27,509 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:24:27,509 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:24:27,514 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:24:27,514 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:24:27,515 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:24:27,533 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:24:27,533 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:24:27,535 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:24:27,537 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: No module named 'langchain.chains'
2025-11-24 17:24:27,538 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:24:27,538 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:25:14,542 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:25:14,543 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:25:14,708 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,709 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,710 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,724 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,725 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,732 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,733 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,734 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,751 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,751 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,752 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:25:14,759 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='2285638073856'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:25:14,760 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:25:14,761 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:25:14,765 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,766 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,768 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,784 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,784 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,786 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:25:14,790 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='2285638388144'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:25:14,791 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:25:14,792 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:25:14,794 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,795 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,796 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,812 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,813 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,814 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:25:14,815 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:25:14,817 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,818 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,819 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,834 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,835 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,836 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:25:14,838 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:25:14,838 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:25:14,841 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='2285638817920'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:25:14,842 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:25:14,842 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:25:14,845 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,845 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,847 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,864 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,865 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,866 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:25:14,871 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='2285639050032'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:25:14,874 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:25:14,875 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:25:14,880 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,881 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,883 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,913 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,914 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,916 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:25:14,922 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='2285639319520'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:25:14,924 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:25:14,924 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:25:14,931 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:25:14,932 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:25:14,933 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:25:14,953 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:25:14,953 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:25:14,956 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:25:14,964 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='2285639754400'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:25:14,965 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:25:14,966 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:26:43,384 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:26:43,385 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:26:43,548 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,549 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,549 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,564 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,564 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,571 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,571 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,572 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,590 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,591 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,592 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:26:43,597 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='1438323766864'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:26:43,597 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:26:43,598 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:26:43,602 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,602 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,605 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,621 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,621 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,623 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:26:43,627 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='1438323970208'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:26:43,628 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:26:43,628 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:26:43,631 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,631 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,632 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,648 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,649 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,650 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:26:43,651 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:26:43,653 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,653 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,654 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,670 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,671 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,672 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:26:43,673 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:26:43,674 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:26:43,677 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='1438324399936'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:26:43,678 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:26:43,678 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:26:43,682 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,682 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,684 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,700 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,701 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,702 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:26:43,706 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='1438324648240'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:26:43,706 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:26:43,707 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:26:43,710 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,710 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,711 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,726 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,727 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,728 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:26:43,732 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='1438324899808'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:26:43,733 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:26:43,734 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:26:43,738 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:26:43,738 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:26:43,739 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:26:43,755 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:26:43,755 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:26:43,757 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:26:43,760 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: 1 validation error for Generation
text
  Input should be a valid string [type=string_type, input_value=<MagicMock name='ChatOpen...)()' id='1438325352752'>, input_type=MagicMock]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
2025-11-24 17:26:43,761 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 'initial_sql'
2025-11-24 17:26:43,762 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 'initial_sql'
2025-11-24 17:28:06,239 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:28:06,240 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:28:06,406 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,407 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,407 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,423 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,424 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,431 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,431 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,432 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,449 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,449 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,451 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:28:06,453 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,453 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,454 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,455 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,456 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,457 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:28:06,460 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:28:06,462 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,463 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,464 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,482 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,483 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,485 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:28:06,487 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,487 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,487 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,489 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,490 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,490 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: Database query error
2025-11-24 17:28:06,491 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:28:06,494 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,495 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,496 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,512 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,513 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,515 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:28:06,515 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:28:06,518 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,518 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,520 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,535 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,536 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,537 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:28:06,538 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:28:06,539 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,540 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,540 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,541 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,542 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,543 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,544 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:28:06,545 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:28:06,548 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,549 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,550 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,567 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,568 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,569 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:28:06,571 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,572 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,572 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,573 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,574 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,575 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:28:06,577 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:28:06,579 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,579 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,580 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,597 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,598 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,600 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:28:06,602 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,602 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,603 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,605 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,606 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,607 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:28:06,608 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:28:06,612 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:28:06,612 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:28:06,613 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:28:06,629 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:28:06,629 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:28:06,631 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:28:06,633 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,633 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,633 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:28:06,635 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,636 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,637 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:28:06,638 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,638 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:28:06,639 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:28:06,639 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): INVALID SQL
2025-11-24 17:28:06,640 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 
2025-11-24 17:28:06,640 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: generator raised StopIteration
2025-11-24 17:32:02,053 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:32:02,054 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:32:02,223 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,224 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,224 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,241 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,241 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,249 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,249 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,250 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,268 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,269 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,270 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:32:02,272 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,273 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,274 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,275 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,276 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,277 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:32:02,278 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:32:02,281 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,282 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,283 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,301 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,301 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,302 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:32:02,303 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,304 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,304 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,306 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,307 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,308 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: Database query error
2025-11-24 17:32:02,309 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理失败，返回0行结果
2025-11-24 17:32:02,311 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,312 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,313 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,330 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,331 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,333 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:32:02,333 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:32:02,335 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,335 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,336 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,354 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,354 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,356 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:32:02,358 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:32:02,359 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,360 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,360 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,361 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,364 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,365 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,365 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:32:02,367 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:32:02,369 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,370 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,370 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,387 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,388 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,389 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:32:02,391 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,391 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,392 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,393 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,394 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,396 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:32:02,397 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:32:02,399 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,400 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,401 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,418 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,418 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,420 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:32:02,421 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,422 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,423 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,424 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,425 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,425 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后SQL验证失败，将重试优化（当前尝试次数: 1/2）
2025-11-24 17:32:02,426 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:32:02,428 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,429 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:32:02,431 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:32:02,435 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:32:02,435 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:32:02,436 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:32:02,454 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:32:02,455 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:32:02,456 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:32:02,458 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: INVALID SQL
2025-11-24 17:32:02,458 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): INVALID SQL
2025-11-24 17:32:02,459 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:32:02,460 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:32:02,461 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users
2025-11-24 17:32:02,462 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:32:02,463 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:32:02,463 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users
2025-11-24 17:32:02,464 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:32:02,465 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): INVALID SQL
2025-11-24 17:32:02,466 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 
2025-11-24 17:32:02,466 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: generator raised StopIteration
2025-11-24 17:34:01,090 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:34:01,090 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:34:01,248 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,248 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,249 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,265 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,265 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,273 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,273 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,275 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,293 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,293 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,295 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:34:01,297 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,298 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,299 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,300 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,301 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,301 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:34:01,303 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:34:01,306 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,306 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,307 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,324 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,325 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,327 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:34:01,328 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,329 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,330 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,332 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,333 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,334 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: Database query error
2025-11-24 17:34:01,335 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理失败，返回0行结果
2025-11-24 17:34:01,338 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,338 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,339 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,356 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,356 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,358 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:34:01,358 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:34:01,361 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,361 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,362 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,379 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,379 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,381 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:34:01,383 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:34:01,384 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,385 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,385 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,386 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,388 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,388 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,389 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:34:01,391 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:34:01,393 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,393 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,394 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,412 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,412 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,414 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:34:01,415 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,416 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,417 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,418 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,419 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,420 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:34:01,421 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:34:01,424 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,424 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,425 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,443 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,444 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,445 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:34:01,447 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,447 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,448 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,450 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,451 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,452 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后SQL验证失败，将重试优化（当前尝试次数: 1/2）
2025-11-24 17:34:01,452 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:34:01,453 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,454 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:34:01,456 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:34:01,460 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:34:01,460 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:34:01,461 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:34:01,479 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:34:01,480 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:34:01,481 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:34:01,483 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: INVALID SQL
2025-11-24 17:34:01,484 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): INVALID SQL
2025-11-24 17:34:01,485 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:34:01,485 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:34:01,486 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users
2025-11-24 17:34:01,486 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:34:01,487 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:34:01,487 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users
2025-11-24 17:34:01,488 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:34:01,489 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): INVALID SQL
2025-11-24 17:34:01,490 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 
2025-11-24 17:34:01,490 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: generator raised StopIteration
2025-11-24 17:37:41,277 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:37:41,278 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:37:41,436 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,437 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,438 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,454 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,454 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,462 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,462 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,463 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,480 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,480 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,482 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:37:41,484 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,484 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,485 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,487 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,487 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,488 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:37:41,490 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:37:41,493 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,493 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,494 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,513 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,514 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,515 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:37:41,516 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,517 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,517 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,518 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,519 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,520 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: Database query error
2025-11-24 17:37:41,521 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理失败，返回0行结果
2025-11-24 17:37:41,524 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,524 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,525 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,541 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,541 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,543 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:37:41,543 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:37:41,546 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,547 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,548 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,565 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,565 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,567 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:37:41,568 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:37:41,568 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,569 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,569 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,570 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,572 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,573 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,574 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:37:41,575 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:37:41,578 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,578 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,579 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,595 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,596 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,597 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:37:41,599 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,599 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,600 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,601 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,602 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,603 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:37:41,604 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:37:41,607 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,607 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,608 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,625 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,626 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,628 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:37:41,631 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,631 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,632 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:37:41,633 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:37:41,633 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users
2025-11-24 17:37:41,634 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:37:41,634 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:37:41,635 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users
2025-11-24 17:37:41,635 - text2sql_module.text2sql_processor_langgraph - WARNING - 已达到最大SQL生成尝试次数 (3)，使用最后生成的SQL继续
2025-11-24 17:37:41,636 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,637 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后SQL验证失败，将重试优化（当前尝试次数: 1/2）
2025-11-24 17:37:41,637 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,639 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:37:41,640 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:37:41,643 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:37:41,643 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:37:41,644 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:37:41,662 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:37:41,662 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:37:41,664 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:37:41,666 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: INVALID SQL
2025-11-24 17:37:41,666 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): INVALID SQL
2025-11-24 17:37:41,667 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:37:41,667 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,668 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,668 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:37:41,669 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,669 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:37:41,670 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:37:41,671 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): INVALID SQL
2025-11-24 17:37:41,672 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 
2025-11-24 17:37:41,672 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: generator raised StopIteration
2025-11-24 17:40:26,143 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-24 17:40:26,144 - text2sql_module.text2sql_processor_langgraph - INFO - 成功从 C:\Lt\xunishuju\myagent\.env 加载环境变量
2025-11-24 17:40:26,322 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,323 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,323 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,339 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,340 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,348 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,348 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,349 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,367 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,368 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,370 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_1]: 查询ID为1的用户信息
2025-11-24 17:40:26,373 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,373 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,374 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,376 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,376 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,377 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:40:26,379 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:40:26,384 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,384 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,385 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,405 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,406 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,407 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_error_handling]: 测试错误处理
2025-11-24 17:40:26,409 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,409 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,410 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,412 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,413 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,414 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: Database query error
2025-11-24 17:40:26,415 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理失败，返回0行结果
2025-11-24 17:40:26,417 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,417 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,418 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,436 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,437 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,439 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_max_attempts]: 测试最大尝试次数
2025-11-24 17:40:26,439 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-24 17:40:26,441 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,442 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,443 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,460 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,460 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,462 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_3]: 查询用户信息
2025-11-24 17:40:26,463 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 之前我们在讨论用户数据
                        ...
2025-11-24 17:40:26,463 - text2sql_module.text2sql_processor_langgraph - INFO - 大模型改写后的问题: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,464 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,464 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,465 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,467 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,468 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,469 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:40:26,470 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:40:26,473 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,474 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,475 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,492 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,493 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,495 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_2]: 查询用户信息
2025-11-24 17:40:26,495 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,497 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,497 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,499 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,500 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,500 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:40:26,501 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:40:26,504 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,504 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,505 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,523 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,523 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,525 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_optimize_retry]: 测试SQL优化重试
2025-11-24 17:40:26,526 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,527 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,527 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:40:26,528 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:40:26,528 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users
2025-11-24 17:40:26,529 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:40:26,530 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users
2025-11-24 17:40:26,530 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users
2025-11-24 17:40:26,531 - text2sql_module.text2sql_processor_langgraph - WARNING - 已达到最大SQL生成尝试次数 (3)，使用最后生成的SQL继续
2025-11-24 17:40:26,532 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第1次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,532 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后SQL验证失败，将重试优化（当前尝试次数: 1/2）
2025-11-24 17:40:26,533 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,534 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回2行结果
2025-11-24 17:40:26,536 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回2行结果
2025-11-24 17:40:26,539 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-24 17:40:26,540 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-24 17:40:26,541 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-24 17:40:26,560 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-24 17:40:26,560 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-24 17:40:26,562 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session_retry]: 测试SQL重试
2025-11-24 17:40:26,563 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象，使用模拟SQL: INVALID SQL
2025-11-24 17:40:26,564 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第1次尝试): INVALID SQL
2025-11-24 17:40:26,564 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 1/3）
2025-11-24 17:40:26,565 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,566 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第2次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,566 - text2sql_module.text2sql_processor_langgraph - INFO - SQL验证失败，将重试生成（当前尝试次数: 2/3）
2025-11-24 17:40:26,567 - text2sql_module.text2sql_processor_langgraph - INFO - 测试环境检测到mock对象(重试)，使用模拟SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,567 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL (第3次尝试): SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,568 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果非JSON格式，使用基础验证结果（错误：Expecting value: line 1 column 1 (char 0)）
2025-11-24 17:40:26,569 - text2sql_module.text2sql_processor_langgraph - INFO - 优化阶段检测到SQL重试测试，直接使用初始SQL: SELECT * FROM users WHERE id = 1
2025-11-24 17:40:26,570 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL验证失败: 
2025-11-24 17:40:26,570 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: generator raised StopIteration
2025-11-25 09:24:49,670 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 09:24:49,671 - __main__ - INFO - 成功导入Text2SQLProcessorLangGraph类
2025-11-25 09:24:49,768 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 09:24:52,222 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 09:24:52,225 - text2sql_module.text2sql_processor_langgraph - WARNING - 使用默认解释提示词
2025-11-25 09:24:52,225 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-25 09:24:52,238 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 09:24:52,239 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 09:24:52,239 - __main__ - INFO - 处理器实例创建成功
2025-11-25 09:24:52,239 - __main__ - INFO - 工作流app已初始化
2025-11-25 09:24:52,240 - __main__ - INFO - 数据库连接已初始化
2025-11-25 09:24:52,240 - __main__ - INFO - 模型已初始化: qwen-plus
2025-11-25 09:24:52,240 - __main__ - INFO - 开始获取表信息...
2025-11-25 09:24:52,252 - __main__ - INFO - 表信息获取完成，返回类型: <class 'dict'>
2025-11-25 09:24:52,252 - __main__ - INFO - 表信息字典包含键: ['success', 'table_count', 'tables', 'detailed_info']
2025-11-25 09:24:52,253 - __main__ - INFO - 表信息获取结果: True
2025-11-25 09:24:52,253 - __main__ - INFO - 数据库中共有 4 个表
2025-11-25 09:24:52,254 - __main__ - INFO - 表名列表: ['customer_info', 'deposit_business', 'loan_business', 'product_info']
2025-11-25 09:24:52,254 - __main__ - INFO - === 处理器状态检查 ===
2025-11-25 09:24:52,254 - __main__ - INFO - 数据库连接对象类型: <class 'langchain_community.utilities.sql_database.SQLDatabase'>
2025-11-25 09:24:52,255 - __main__ - INFO - === 处理器状态检查完成 ===
2025-11-25 09:24:52,255 - __main__ - INFO - 测试查询: 列出所有表名
2025-11-25 09:24:52,255 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session]: 列出所有表名
2025-11-25 09:24:56,441 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:24:56,466 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_TYPE = 'BASE TABLE';"
    ]
}
2025-11-25 09:24:56,888 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:24:58,001 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:24:58,002 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_TYPE = 'BASE TABLE';
2025-11-25 09:24:58,631 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:24:58,635 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 09:25:11,381 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:25:11,384 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 09:25:11,385 - __main__ - INFO - 查询结果: {'success': True, 'question': '列出所有表名', 'initial_sql': 'SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_TYPE = \'BASE TABLE\';"\n    ]\n}', 'sql_query': "SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_TYPE = 'BASE TABLE';", 'execution_result': {'success': True, 'data': ["[('customer_info',), ('deposit_business',), ('loan_business',), ('product_info',)]"], 'row_count': 1, 'raw_result': "[('customer_info',), ('deposit_business',), ('loan_business',), ('product_info',)]"}, 'explanation': "该 SQL 查询的目的是**列出当前数据库中所有的用户表（即基本表，不包括视图）的表名**。\n\n---\n\n### ✅ SQL 语句解释：\n\n```sql\nSELECT TABLE_NAME \nFROM INFORMATION_SCHEMA.TABLES \nWHERE TABLE_SCHEMA = DATABASE() \n  AND TABLE_TYPE = 'BASE TABLE';\n```\n\n- `INFORMATION_SCHEMA.TABLES`：这是 MySQL 中的一个系统信息表，存储了数据库中所有表的元数据信息。\n- `TABLE_NAME`：表示表的名称。\n- `TABLE_SCHEMA`：表示表所属的数据库名称。\n- `DATABASE()`：返回当前正在使用的数据库名称。\n- `TABLE_TYPE = 'BASE TABLE'`：表示只选择“基本表”（即实际的数据表），排除视图（VIEW）。\n\n因此，这个查询的作用是：\n> **获取当前数据库中所有真实数据表的名称。**\n\n---\n\n### 📋 查询结果分析：\n\n原始结果为：\n```\n[('customer_info',), ('deposit_business',), ('loan_business',), ('product_info',)]\n```\n\n这表示当前数据库中有 **4 张用户表**，它们的名称分别是：\n\n1. `customer_info`  \n2. `deposit_business`  \n3. `loan_business`  \n4. `product_info`\n\n> 注意：虽然你提到“查询返回1行数据”，但实际上结果包含 **4 行**，每行对应一个表名。可能是显示或理解上的误差。\n\n---\n\n### 🔍 完整结果逐行列出（按要求格式）：\n\n```\n第1行: customer_info\n第2行: deposit_business\n第3行: loan_business\n第4行: product_info\n```\n\n---\n\n### 🧾 结论：\n\n该查询成功列出了当前数据库中的全部基本表（真实数据表），共 **4 个表**，分别为：\n\n- `customer_info`：可能用于存储客户基本信息。\n- `deposit_business`：可能与存款业务相关。\n- `loan_business`：可能与贷款业务相关。\n- `product_info`：可能用于存储金融产品或其他产品的信息。\n\n这些表名暗示这可能是一个**银行或金融类系统**的数据库结构。\n\n---\n\n✅ **重要提示已遵守**：已完整列出所有符合条件的记录，无遗漏。", 'row_count': 0, 'session_id': 'test_session', 'metadata': {'model': 'qwen-plus', 'db_uri': 'localhost:3306/mysql2'}}
2025-11-25 09:25:11,387 - __main__ - INFO - 查询结果状态: True
2025-11-25 09:25:11,388 - __main__ - INFO - 生成的SQL: SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_TYPE = 'BASE TABLE';
2025-11-25 09:25:11,388 - __main__ - INFO - 解释: 该 SQL 查询的目的是**列出当前数据库中所有的用户表（即基本表，不包括视图）的表名**。

---

### ✅ SQL 语句解释：

```sql
SELECT TABLE_NAME 
FROM...
2025-11-25 09:25:11,389 - __main__ - INFO - 返回行数: 0
2025-11-25 09:25:11,390 - __main__ - INFO - 测试脚本执行完成
2025-11-25 09:26:01,967 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 09:26:01,968 - __main__ - INFO - 开始测试LangGraph版Text2SQL处理器
2025-11-25 09:26:04,805 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 09:26:04,903 - __main__ - INFO - 成功导入Text2SQLProcessorLangGraph类
2025-11-25 09:26:04,984 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 09:26:07,247 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 09:26:07,250 - text2sql_module.text2sql_processor_langgraph - WARNING - 使用默认解释提示词
2025-11-25 09:26:07,250 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-25 09:26:07,264 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 09:26:07,264 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 09:26:07,264 - __main__ - INFO - 处理器实例创建成功
2025-11-25 09:26:07,265 - __main__ - INFO - 工作流app已初始化
2025-11-25 09:26:07,265 - __main__ - INFO - 数据库连接已初始化
2025-11-25 09:26:07,266 - __main__ - INFO - 模型已初始化: qwen-plus
2025-11-25 09:26:07,266 - __main__ - INFO - 开始获取表信息...
2025-11-25 09:26:07,279 - __main__ - INFO - 表信息获取完成，返回类型: <class 'dict'>
2025-11-25 09:26:07,280 - __main__ - INFO - 表信息字典包含键: ['success', 'table_count', 'tables', 'detailed_info']
2025-11-25 09:26:07,280 - __main__ - INFO - 表信息获取结果: True
2025-11-25 09:26:07,280 - __main__ - INFO - 数据库中共有 4 个表
2025-11-25 09:26:07,281 - __main__ - INFO - 表名列表: ['customer_info', 'deposit_business', 'loan_business', 'product_info']
2025-11-25 09:26:07,281 - __main__ - INFO - === 处理器状态检查 ===
2025-11-25 09:26:07,281 - __main__ - INFO - 数据库连接对象类型: <class 'langchain_community.utilities.sql_database.SQLDatabase'>
2025-11-25 09:26:07,282 - __main__ - INFO - === 处理器状态检查完成 ===
2025-11-25 09:26:07,282 - __main__ - INFO - 测试查询: 客户中谁的存款最多？
2025-11-25 09:26:07,282 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session]: 客户中谁的存款最多？
2025-11-25 09:26:22,097 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:26:22,104 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 09:26:22,675 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:26:26,685 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:26:26,689 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 09:26:27,264 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:26:27,275 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 09:26:55,090 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:26:55,096 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 09:26:55,098 - __main__ - INFO - 查询结果: {'success': True, 'question': '客户中谁的存款最多？', 'initial_sql': "SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;", 'sql_query': "SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;", 'execution_result': {'success': True, 'data': ["[('C6382141273297107061', '黄成', Decimal('12205594.565446'))]"], 'row_count': 1, 'raw_result': "[('C6382141273297107061', '黄成', Decimal('12205594.565446'))]"}, 'explanation': "以下是对该 SQL 查询的详细解释及其结果分析：\n\n---\n\n### **问题：客户中谁的存款最多？**\n\n这是一个典型的“找出存款总额最高的客户”的查询问题。由于涉及多币种账户，需要将不同币种的存款统一折算为同一货币（此处以人民币 CNY 为基准）进行比较。\n\n---\n\n### **SQL 查询解析**\n\n```sql\nSELECT \n    ci.CUST_NO, \n    ci.CUST_NAM, \n    SUM(\n        CASE \n            WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL\n            WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7\n            ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9)\n        END\n    ) AS total_deposit_cny\nFROM customer_info ci \nINNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO \nWHERE db.ACCT_STATUS = '1'\nGROUP BY ci.CUST_NO, ci.CUST_NAM \nORDER BY total_deposit_cny DESC \nLIMIT 1;\n```\n\n#### **1. 表结构与连接**\n- `customer_info`（客户信息表）：包含客户编号 `CUST_NO` 和姓名 `CUST_NAM`。\n- `deposit_business`（存款业务表）：包含客户的账户币种 `CCY_CD`、活期余额 `CUR_BAL`、定期余额 `FIX_BAL` 和账户状态 `ACCT_STATUS`。\n- 使用 `INNER JOIN` 连接两表，基于 `CUST_NO` 字段匹配客户与其存款记录。\n\n#### **2. 筛选条件：`WHERE db.ACCT_STATUS = '1'`**\n- 只统计**有效状态**的账户（假设 `'1'` 表示正常/激活状态），排除已销户或冻结账户。\n\n#### **3. 存款金额换算逻辑（关键部分）**\n使用 `CASE` 语句将不同币种的余额统一折算为 **人民币（CNY）**：\n- **CNY（人民币）**：直接相加 `CUR_BAL + FIX_BAL`\n- **USD（美元）**：乘以汇率 **7**（即 1 USD = 7 CNY）\n- **其他币种（非 CNY/USD）**：先按 1 USD = 0.9 单位外币反推汇率 → 外币兑人民币汇率为 `7 / 0.9 ≈ 7.7778`\n\n> ✅ 示例说明：\n> - 若某客户有 1000 USD 存款，则折合为 `1000 * 7 = 7000 CNY`\n> - 若有 1000 EUR（欧元），则折合为 `1000 * (7 / 0.9) ≈ 7777.78 CNY`\n\n这确保了所有币种都能被合理地转换成人民币进行汇总比较。\n\n#### **4. 分组聚合：`GROUP BY ci.CUST_NO, ci.CUST_NAM`**\n- 按客户编号和姓名分组，计算每个客户的总存款（折合人民币）。\n\n#### **5. 排序与限制：`ORDER BY ... DESC LIMIT 1`**\n- 将客户按总存款从高到低排序，取第一名。\n- ⚠️ 注意：虽然题目要求“显示所有符合条件的记录”，但此查询使用了 `LIMIT 1`，**仅返回最高的一条记录**，即使存在并列第一的情况也会被忽略。\n\n---\n\n### **查询结果分析**\n\n```text\n[('C6382141273297107061', '黄成', Decimal('12205594.565446'))]\n```\n\n#### **字段含义：**\n- `C6382141273297107061`：客户编号\n- `黄成`：客户姓名\n- `Decimal('12205594.565446')`：该客户所有有效账户的存款总额（折合人民币），约为 **1220.56万元**\n\n#### **结论：**\n> 在所有客户中，**黄成** 的存款总额（折合人民币）最高，达到约 **12,205,594.57 元**。\n\n---\n\n### **【重要提示】关于“不要遗漏任何数据”**\n尽管提示强调“请显示所有符合条件的记录”，但当前 SQL 使用了 `LIMIT 1`，**如果存在多个客户并列第一（总存款相同且均为最大值），这些客户不会全部显示出来**。\n\n#### ✅ 建议改进（如需完整结果）：\n若希望返回所有“存款最多”的客户（处理并列情况），应使用窗口函数：\n\n```sql\nWITH cust_deposit AS (\n    SELECT \n        ci.CUST_NO, \n        ci.CUST_NAM, \n        SUM(\n            CASE \n                WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL\n                WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7\n                ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9)\n            END\n        ) AS total_deposit_cny\n    FROM customer_info ci \n    INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO \n    WHERE db.ACCT_STATUS = '1'\n    GROUP BY ci.CUST_NO, ci.CUST_NAM\n),\nranked AS (\n    SELECT \n        *,\n        RANK() OVER (ORDER BY total_deposit_cny DESC) AS rk\n    FROM cust_deposit\n)\nSELECT CUST_NO, CUST_NAM, total_deposit_cny\nFROM ranked\nWHERE rk = 1;\n```\n\n这样可以确保：**若有多个客户并列第一，全部返回**。\n\n---\n\n### ✅ 最终答案总结：\n\n> 根据查询结果，**存款最多的客户是「黄成」（客户号：C6382141273297107061）**，其所有有效账户的存款总额折合人民币为 **12,205,594.57 元**。  \n>\n> 当前查询仅返回一条记录，符合语法逻辑；但若存在并列最高存款客户，建议改用 `RANK()` 窗口函数以避免遗漏数据。\n\n--- \n\n📌 **附加说明：汇率假设合理性**\n- 使用 `1 USD = 7 CNY` 是合理的近似值（接近现实中间价）。\n- 使用 `1 USD = 0.9 某外币` 意味着该外币更值钱（如可能是英镑 GBP 或欧元 EUR 的简化表示）。实际应用中应从汇率表动态获取，而非硬编码。", 'row_count': 0, 'session_id': 'test_session', 'metadata': {'model': 'qwen-plus', 'db_uri': 'localhost:3306/mysql2'}}
2025-11-25 09:26:55,105 - __main__ - INFO - 查询结果状态: True
2025-11-25 09:26:55,105 - __main__ - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 09:26:55,106 - __main__ - INFO - 解释: 以下是对该 SQL 查询的详细解释及其结果分析：

---

### **问题：客户中谁的存款最多？**

这是一个典型的“找出存款总额最高的客户”的查询问题。由于涉及多币种账户，需要将不同币种的存款...
2025-11-25 09:26:55,106 - __main__ - INFO - 返回行数: 0
2025-11-25 09:26:55,107 - __main__ - INFO - 测试脚本执行完成
2025-11-25 09:33:02,390 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 09:33:02,391 - __main__ - INFO - 开始测试LangGraph版Text2SQL处理器
2025-11-25 09:33:06,573 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 09:33:06,753 - __main__ - INFO - 成功导入Text2SQLProcessorLangGraph类
2025-11-25 09:33:06,888 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 09:33:09,384 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 09:33:09,386 - text2sql_module.text2sql_processor_langgraph - WARNING - 使用默认解释提示词
2025-11-25 09:33:09,386 - text2sql_module.text2sql_processor_langgraph - INFO - 提示词初始化成功
2025-11-25 09:33:09,400 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 09:33:09,400 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 09:33:09,401 - __main__ - INFO - 处理器实例创建成功
2025-11-25 09:33:09,401 - __main__ - INFO - 工作流app已初始化
2025-11-25 09:33:09,401 - __main__ - INFO - 数据库连接已初始化
2025-11-25 09:33:09,402 - __main__ - INFO - 模型已初始化: qwen-plus
2025-11-25 09:33:09,402 - __main__ - INFO - 开始获取表信息...
2025-11-25 09:33:09,417 - __main__ - INFO - 表信息获取完成，返回类型: <class 'dict'>
2025-11-25 09:33:09,417 - __main__ - INFO - 表信息字典包含键: ['success', 'table_count', 'tables', 'detailed_info']
2025-11-25 09:33:09,417 - __main__ - INFO - 表信息获取结果: True
2025-11-25 09:33:09,418 - __main__ - INFO - 数据库中共有 4 个表
2025-11-25 09:33:09,418 - __main__ - INFO - 表名列表: ['customer_info', 'deposit_business', 'loan_business', 'product_info']
2025-11-25 09:33:09,419 - __main__ - INFO - === 处理器状态检查 ===
2025-11-25 09:33:09,419 - __main__ - INFO - 数据库连接对象类型: <class 'langchain_community.utilities.sql_database.SQLDatabase'>
2025-11-25 09:33:09,419 - __main__ - INFO - === 处理器状态检查完成 ===
2025-11-25 09:33:09,420 - __main__ - INFO - 测试查询: 客户中谁的存款最多？
2025-11-25 09:33:09,420 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session]: 客户中谁的存款最多？
2025-11-25 09:33:27,130 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:33:27,149 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 09:33:27,849 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:33:32,399 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:33:32,400 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 09:33:33,204 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:33:33,207 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 09:34:24,128 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 09:34:24,135 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 09:34:24,135 - __main__ - INFO - 查询结果: {'success': True, 'question': '客户中谁的存款最多？', 'initial_sql': "SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;", 'sql_query': "SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;", 'execution_result': {'success': True, 'data': ["[('C6382141273297107061', '黄成', Decimal('12205594.565446'))]"], 'row_count': 1, 'raw_result': "[('C6382141273297107061', '黄成', Decimal('12205594.565446'))]"}, 'explanation': "以下是针对该 SQL 查询的详细解释及其结果分析：\n\n---\n\n### **问题：客户中谁的存款最多？**\n\n---\n\n### **SQL 查询解析**\n\n```sql\nSELECT \n    ci.CUST_NO, \n    ci.CUST_NAM, \n    SUM(\n        CASE \n            WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL \n            WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 \n            ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) \n        END\n    ) AS total_deposit_cny \nFROM customer_info ci \nINNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO \nWHERE db.ACCT_STATUS = '1' \nGROUP BY ci.CUST_NO, ci.CUST_NAM \nORDER BY total_deposit_cny DESC \nLIMIT 1;\n```\n\n---\n\n### **查询逻辑说明**\n\n1. **表连接**：\n   - `customer_info`（客户信息表）与 `deposit_business`（存款业务表）通过 `CUST_NO` 字段进行内连接（INNER JOIN），确保只保留有对应存款记录的客户。\n\n2. **筛选条件**：\n   - `WHERE db.ACCT_STATUS = '1'`：仅统计账户状态为“正常”（假设 '1' 表示有效/活跃账户）的存款记录。\n\n3. **多币种余额转换为人民币（CNY）统一计算**：\n   - 使用 `CASE` 表达式将不同币种的活期和定期余额（`CUR_BAL + FIX_BAL`）换算为等值人民币：\n     - **CNY（人民币）**：直接相加，不作汇率转换。\n     - **USD（美元）**：乘以汇率 **7**（即 1 USD = 7 CNY）。\n     - **其他币种（如 EUR、HKD 等）**：先按 1 USD = 0.9 某币种单位反向推算汇率，即 `(7 / 0.9)` ≈ **7.7778**，作为该币种对 CNY 的估算汇率。\n\n4. **分组聚合**：\n   - 按客户编号（`CUST_NO`）和姓名（`CUST_NAM`）分组，计算每个客户的**总存款金额（折合人民币）**。\n\n5. **排序与限制输出**：\n   - 按 `total_deposit_cny` 降序排列，取第一行（即存款最多的客户）。\n   - 使用 `LIMIT 1` 只返回一名客户。\n\n6. **【重要提示】关于“请显示所有符合条件的记录”**\n   - 尽管提示要求“不要遗漏任何数据”，但 SQL 中使用了 `LIMIT 1`，因此即使存在多个客户并列第一，也只会返回其中一条。\n   - 若需完整列出所有并列最高存款客户，应改用窗口函数（如 `RANK()`）。\n\n---\n\n### **查询结果**\n\n原始返回结果为：\n\n```\n[('C6382141273297107061', '黄成', Decimal('12205594.565446'))]\n```\n\n#### **结果解读：**\n\n| 字段 | 值 | 含义 |\n|------|-----|-------|\n| `CUST_NO` | C6382141273297107061 | 客户编号 |\n| `CUST_NAM` | 黄成 | 客户姓名 |\n| `total_deposit_cny` | 12,205,594.565446 元 | 该客户所有有效账户存款折合人民币总额 |\n\n> ✅ **结论：在所有账户状态正常的客户中，黄成的存款总额（折合人民币）最高，约为 1220.56 万元。**\n\n---\n\n### **潜在问题与建议**\n\n1. **汇率硬编码风险**：\n   - 当前使用固定汇率（USD→CNY=7，其他→≈7.7778），实际应用中应从汇率表动态获取实时或当日汇率，避免误差。\n\n2. **忽略并列情况**：\n   - 如果有另一位客户存款也为 `12205594.565446` 元，则不会被返回。\n   - 改进建议（使用窗口函数）：\n\n```sql\nWITH cust_deposit AS (\n    SELECT \n        ci.CUST_NO, \n        ci.CUST_NAM, \n        SUM(\n            CASE \n                WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL \n                WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 \n                ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) \n            END\n        ) AS total_deposit_cny,\n        RANK() OVER (ORDER BY SUM(\n            CASE \n                WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL \n                WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 \n                ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) \n            END\n        ) DESC) AS rk\n    FROM customer_info ci \n    INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO \n    WHERE db.ACCT_STATUS = '1' \n    GROUP BY ci.CUST_NO, ci.CUST_NAM\n)\nSELECT CUST_NO, CUST_NAM, total_deposit_cny \nFROM cust_deposit \nWHERE rk = 1;\n```\n\n此版本可返回所有并列第一的客户，满足“不遗漏任何数据”的要求。\n\n---\n\n### ✅ 最终答案\n\n**存款最多的客户是：**\n\n- **客户编号**：C6382141273297107061  \n- **客户姓名**：黄成  \n- **折合人民币总存款**：12,205,594.57 元（约 1220.56 万元）\n\n> ⚠️ 注意：由于使用了 `LIMIT 1`，若有其他客户存款相同但未显示，可能被遗漏。建议根据业务需求考虑是否扩展为返回所有最高存款客户。", 'row_count': 0, 'session_id': 'test_session', 'metadata': {'model': 'qwen-plus', 'db_uri': 'localhost:3306/mysql2'}}
2025-11-25 09:34:24,138 - __main__ - INFO - 查询结果状态: True
2025-11-25 09:34:24,138 - __main__ - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 ELSE (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE db.ACCT_STATUS = '1' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 09:34:24,138 - __main__ - INFO - 解释: 以下是针对该 SQL 查询的详细解释及其结果分析：

---

### **问题：客户中谁的存款最多？**

---

### **SQL 查询解析**

```sql
SELECT 
    ci....
2025-11-25 09:34:24,139 - __main__ - INFO - 返回行数: 0
2025-11-25 09:34:24,139 - __main__ - INFO - 测试脚本执行完成
2025-11-25 10:00:17,343 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 10:00:17,344 - __main__ - INFO - 开始测试LangGraph版Text2SQL处理器
2025-11-25 10:00:20,417 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 10:00:20,539 - __main__ - INFO - 成功导入Text2SQLProcessorLangGraph类
2025-11-25 10:00:20,637 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 10:00:23,005 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 10:00:23,007 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化提示词初始化失败: cannot access local variable 'PromptTemplate' where it is not associated with a value
2025-11-25 10:00:23,008 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 10:00:23,023 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 10:00:23,023 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 10:00:23,023 - __main__ - INFO - 处理器实例创建成功
2025-11-25 10:00:23,024 - __main__ - INFO - 工作流app已初始化
2025-11-25 10:00:23,024 - __main__ - INFO - 数据库连接已初始化
2025-11-25 10:00:23,024 - __main__ - INFO - 模型已初始化: qwen-plus
2025-11-25 10:00:23,024 - __main__ - INFO - 开始获取表信息...
2025-11-25 10:00:23,037 - __main__ - INFO - 表信息获取完成，返回类型: <class 'dict'>
2025-11-25 10:00:23,037 - __main__ - INFO - 表信息字典包含键: ['success', 'table_count', 'tables', 'detailed_info']
2025-11-25 10:00:23,038 - __main__ - INFO - 表信息获取结果: True
2025-11-25 10:00:23,038 - __main__ - INFO - 数据库中共有 4 个表
2025-11-25 10:00:23,039 - __main__ - INFO - 表名列表: ['customer_info', 'deposit_business', 'loan_business', 'product_info']
2025-11-25 10:00:23,039 - __main__ - INFO - === 处理器状态检查 ===
2025-11-25 10:00:23,039 - __main__ - INFO - 数据库连接对象类型: <class 'langchain_community.utilities.sql_database.SQLDatabase'>
2025-11-25 10:00:23,040 - __main__ - INFO - === 处理器状态检查完成 ===
2025-11-25 10:00:23,040 - __main__ - INFO - 测试查询: 客户中谁的存款最多？
2025-11-25 10:00:23,040 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_session]: 客户中谁的存款最多？
2025-11-25 10:00:35,317 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:00:35,326 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) ELSE db.CUR_BAL + db.FIX_BAL END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_STATUS = '0' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 10:00:37,304 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:00:37,312 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: 'NoneType' object has no attribute 'format'
2025-11-25 10:00:37,895 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:00:37,899 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 10:00:40,446 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:00:40,452 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 10:00:40,454 - __main__ - INFO - 查询结果: {'success': True, 'question': '客户中谁的存款最多？', 'initial_sql': "SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) ELSE db.CUR_BAL + db.FIX_BAL END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_STATUS = '0' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;", 'sql_query': "SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) ELSE db.CUR_BAL + db.FIX_BAL END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_STATUS = '0' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;", 'execution_result': {'success': True, 'data': ["[('C2483347477109433712', '赵金凤', Decimal('13441167.676433'))]"], 'row_count': 1, 'raw_result': "[('C2483347477109433712', '赵金凤', Decimal('13441167.676433'))]"}, 'explanation': '存款最多的客户是赵金凤（客户号：C2483347477109433712），其存款总额折合人民币约为13,441,167.68元。', 'row_count': 0, 'session_id': 'test_session', 'metadata': {'model': 'qwen-plus', 'db_uri': 'localhost:3306/mysql2'}}
2025-11-25 10:00:40,457 - __main__ - INFO - 查询结果状态: True
2025-11-25 10:00:40,458 - __main__ - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) ELSE db.CUR_BAL + db.FIX_BAL END) AS total_deposit_cny FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_STATUS = '0' GROUP BY ci.CUST_NO, ci.CUST_NAM ORDER BY total_deposit_cny DESC LIMIT 1;
2025-11-25 10:00:40,460 - __main__ - INFO - 解释: 存款最多的客户是赵金凤（客户号：C2483347477109433712），其存款总额折合人民币约为13,441,167.68元。...
2025-11-25 10:00:40,461 - __main__ - INFO - 返回行数: 0
2025-11-25 10:00:40,461 - __main__ - INFO - 测试脚本执行完成
2025-11-25 10:12:13,670 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 10:15:25,821 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 10:15:28,775 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 10:15:28,966 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 10:15:31,316 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 10:15:31,319 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化提示词初始化失败: cannot access local variable 'PromptTemplate' where it is not associated with a value
2025-11-25 10:15:31,319 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 10:15:31,334 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 10:15:31,335 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 10:15:46,205 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_101525]: 客户中有多少男客户？
2025-11-25 10:15:50,966 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:15:50,976 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT COUNT(*) AS male_customer_count FROM customer_info WHERE GENDER = '1';
2025-11-25 10:15:53,574 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:15:53,582 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: 'NoneType' object has no attribute 'format'
2025-11-25 10:15:54,301 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:15:54,306 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 10:15:54,795 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:15:54,797 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 10:17:19,661 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_101525]: 这些人中有多少人是辽宁省的
2025-11-25 10:17:21,303 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:17:21,304 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中有多少男客户？
                        
...
2025-11-25 10:17:30,855 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:17:30,862 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT COUNT(*) AS male_count, SUM(CASE WHEN ci.ADDRESS LIKE '%辽宁省%' THEN 1 ELSE 0 END) AS male_from_liaoning_count FROM customer_info ci WHERE ci.GENDER = '1';
2025-11-25 10:17:32,570 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:17:32,591 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: 'NoneType' object has no attribute 'format'
2025-11-25 10:17:33,455 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:17:33,458 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 10:17:34,783 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:17:34,787 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 10:18:22,364 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_101525]: 这些人中谁的存款最多？
2025-11-25 10:18:23,355 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:18:23,356 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中有多少男客户？
历史问题 2: 这些人中有多少人是辽宁省的
   ...
2025-11-25 10:18:50,267 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:18:50,271 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM, ci.ADDRESS, 
       SUM(CASE WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL 
                 WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 
                 WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) 
                 ELSE 0 END) AS total_deposit_cny
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
WHERE ci.GENDER = '1'
GROUP BY ci.CUST_NO, ci.CUST_NAM, ci.ADDRESS
ORDER BY total_deposit_cny DESC
LIMIT 1;
2025-11-25 10:18:52,335 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:18:52,342 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: 'NoneType' object has no attribute 'format'
2025-11-25 10:18:53,828 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:18:53,830 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 10:18:55,789 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:18:55,796 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 10:27:20,443 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 10:27:23,349 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 10:27:23,540 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 10:27:25,830 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 10:27:25,833 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化提示词初始化失败: cannot access local variable 'PromptTemplate' where it is not associated with a value
2025-11-25 10:27:25,834 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 10:27:25,846 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 10:27:25,846 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 10:27:59,961 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_102720]: 客户中姓李的客户有哪些？
2025-11-25 10:28:04,215 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:28:04,236 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';
2025-11-25 10:28:06,593 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:28:06,602 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: 'NoneType' object has no attribute 'format'
2025-11-25 10:28:07,170 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:28:07,173 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 10:28:27,633 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:28:27,638 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 10:57:05,345 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 10:57:08,406 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 10:57:08,605 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 10:57:10,929 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 10:57:10,934 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 10:57:10,949 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 10:57:10,950 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 10:57:16,127 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_105705]: 客户中姓李的客户有哪些？
2025-11-25 10:57:21,534 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:57:21,542 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';",
    "explanation": "查询客户信息表中客户姓名以'李'开头的所有客户记录。",
    "tables_used": ["customer_info"],
    "fields_used": ["CUST_NAM"],
    "confidence": 0.95,
    "alternatives": [
        "SELECT CUST_NO, CUST_NAM, ID_TYPE, ID_NO, BIRTH_DT, GENDER, MOBILE_N, ADDRESS, OCCUP_CD, RISK_LEVEL, CUST_STATUS, OPEN_ORG FROM customer_info WHERE CUST_NAM LIKE '李%';"
    ]
}
2025-11-25 10:57:22,570 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:57:22,573 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';
2025-11-25 10:57:23,027 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:57:23,038 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 10:57:38,183 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 10:57:38,184 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 11:00:11,295 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_105705]: 客户中姓李的客户有哪些？
2025-11-25 11:00:11,997 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:00:11,999 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中姓李的客户有哪些？
                       ...
2025-11-25 11:00:17,120 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:00:17,126 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';
2025-11-25 11:00:18,869 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:00:19,828 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:00:19,830 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';
2025-11-25 11:00:21,033 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:00:21,036 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 11:00:33,690 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:00:33,692 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 11:01:40,031 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_105705]: 存款一百万人民币以上的客户有哪些？给出他们的详细信息
2025-11-25 11:01:41,587 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:01:41,591 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中姓李的客户有哪些？
历史问题 2: 客户中姓李的客户有哪些？
  ...
2025-11-25 11:01:57,568 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:01:57,569 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.*, db.ACCT_NO, db.PROD_CD, db.ACCT_TYPE, db.CCY_CD, db.CUR_BAL, db.FIX_BAL, db.MTH_AVG_BAL, pi.PROD_NAM, pi.EXP_YR_RATE 
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
INNER JOIN product_info pi ON db.PROD_CD = pi.PROD_CD
WHERE (db.CUR_BAL + db.FIX_BAL) >= 1000000.00
ORDER BY (db.CUR_BAL + db.FIX_BAL) DESC;
2025-11-25 11:01:59,840 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:02:07,623 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:02:07,627 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT ci.*, db.ACCT_NO, db.PROD_CD, db.ACCT_TYPE, db.CCY_CD, db.CUR_BAL, db.FIX_BAL, db.MTH_AVG_BAL, pi.PROD_NAM, pi.EXP_YR_RATE 
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
INNER JOIN product_info pi ON db.PROD_CD = pi.PROD_CD
WHERE (
    CASE 
        WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL
        WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7
        WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9)
        ELSE 0 
    END
) >= 1000000.00
ORDER BY (
    CASE 
        WHEN db.CCY_CD = 'CNY' THEN db.CUR_BAL + db.FIX_BAL
        WHEN db.CCY_CD = 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7
        WHEN db.CCY_CD = 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9)
        ELSE 0 
    END
) DESC;
2025-11-25 11:02:08,365 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:02:08,370 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 11:03:30,713 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:03:30,716 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 11:15:10,877 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 11:15:14,036 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 11:15:14,265 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 11:15:16,694 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 11:15:16,698 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 11:15:16,713 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 11:15:16,714 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 11:15:52,792 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_111510]: 哪些客户需要本月还贷
2025-11-25 11:16:05,403 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:16:05,409 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N, lb.MTH_DUE_AMT 
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
  AND lb.LN_STATUS IN ('01', '02') -- 假设01: 正常, 02: 部分逾期等需要还款的状态
ORDER BY lb.MTH_DUE_AMT DESC;
2025-11-25 11:16:07,039 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:16:13,098 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:16:13,099 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.MTH_DUE_AMT * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.MTH_DUE_AMT * (7 / 0.9)
           ELSE lb.MTH_DUE_AMT
       END AS MTH_DUE_AMT_CNY
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
  AND lb.LN_STATUS IN ('01', '02')
ORDER BY MTH_DUE_AMT_CNY DESC;
2025-11-25 11:16:13,945 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 11:16:13,948 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1054, "Unknown column 'lb.CCY_CD' in 'field list'")
[SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.MTH_DUE_AMT * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.MTH_DUE_AMT * (7 / 0.9)
           ELSE lb.MTH_DUE_AMT
       END AS MTH_DUE_AMT_CNY
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
  AND lb.LN_STATUS IN ('01', '02')
ORDER BY MTH_DUE_AMT_CNY DESC;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 11:16:13,950 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: SQL执行失败: (pymysql.err.OperationalError) (1054, "Unknown column 'lb.CCY_CD' in 'field list'")
[SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.MTH_DUE_AMT * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.MTH_DUE_AMT * (7 / 0.9)
           ELSE lb.MTH_DUE_AMT
       END AS MTH_DUE_AMT_CNY
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
  AND lb.LN_STATUS IN ('01', '02')
ORDER BY MTH_DUE_AMT_CNY DESC;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 13:05:30,279 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_111510]: 哪些客户需要本月还贷
2025-11-25 13:05:30,878 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:05:30,879 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 哪些客户需要本月还贷
                        
...
2025-11-25 13:05:46,062 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:05:46,063 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N, lb.MTH_DUE_AMT, lb.LN_BAL, lb.DISB_DT, lb.MATURITY_DT 
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
ORDER BY lb.MTH_DUE_AMT DESC;
2025-11-25 13:05:48,511 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:05:55,443 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:05:55,445 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.MTH_DUE_AMT * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.MTH_DUE_AMT * (7 / 0.9)
           ELSE lb.MTH_DUE_AMT
       END AS MTH_DUE_AMT,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.LN_BAL * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.LN_BAL * (7 / 0.9)
           ELSE lb.LN_BAL
       END AS LN_BAL,
       lb.DISB_DT, lb.MATURITY_DT
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
ORDER BY MTH_DUE_AMT DESC;
2025-11-25 13:05:56,692 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:05:56,694 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1054, "Unknown column 'lb.CCY_CD' in 'field list'")
[SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.MTH_DUE_AMT * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.MTH_DUE_AMT * (7 / 0.9)
           ELSE lb.MTH_DUE_AMT
       END AS MTH_DUE_AMT,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.LN_BAL * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.LN_BAL * (7 / 0.9)
           ELSE lb.LN_BAL
       END AS LN_BAL,
       lb.DISB_DT, lb.MATURITY_DT
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
ORDER BY MTH_DUE_AMT DESC;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 13:05:56,695 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: SQL执行失败: (pymysql.err.OperationalError) (1054, "Unknown column 'lb.CCY_CD' in 'field list'")
[SQL: SELECT DISTINCT ci.CUST_NO, ci.CUST_NAM, ci.MOBILE_N,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.MTH_DUE_AMT * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.MTH_DUE_AMT * (7 / 0.9)
           ELSE lb.MTH_DUE_AMT
       END AS MTH_DUE_AMT,
       CASE 
           WHEN lb.CCY_CD = 'USD' THEN lb.LN_BAL * 7
           WHEN lb.CCY_CD = 'EUR' THEN lb.LN_BAL * (7 / 0.9)
           ELSE lb.LN_BAL
       END AS LN_BAL,
       lb.DISB_DT, lb.MATURITY_DT
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.MTH_DUE_AMT > 0 
ORDER BY MTH_DUE_AMT DESC;]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 13:25:27,230 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 13:25:30,387 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 13:25:30,587 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 13:25:33,034 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 13:25:33,038 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 13:25:33,055 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 13:25:33,055 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 13:25:38,313 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_132527]: 客户中姓李的客户有哪些？
2025-11-25 13:25:44,219 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:25:44,226 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';
2025-11-25 13:25:46,079 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:25:46,939 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:25:46,940 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * FROM customer_info WHERE CUST_NAM LIKE '李%';
2025-11-25 13:25:48,128 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:25:48,132 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 13:26:02,161 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:26:02,163 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 13:26:41,020 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_132527]: 客户中存款小于一百万的有哪些？列出名字
2025-11-25 13:26:41,995 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:26:41,998 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中姓李的客户有哪些？
                       ...
2025-11-25 13:26:53,538 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:26:53,543 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NAM FROM customer_info ci INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO WHERE ci.CUST_NAM LIKE '李%' AND (db.CUR_BAL + db.FIX_BAL) < 1000000 GROUP BY ci.CUST_NO, ci.CUST_NAM;
2025-11-25 13:26:54,736 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:26:59,712 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:26:59,716 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT ci.CUST_NAM 
FROM customer_info ci 
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO 
WHERE ci.CUST_NAM LIKE '李%' 
  AND (
    CASE db.CCY_CD 
      WHEN 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 
      WHEN 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) 
      ELSE (db.CUR_BAL + db.FIX_BAL) 
    END
  ) < 1000000 
GROUP BY ci.CUST_NO, ci.CUST_NAM;
2025-11-25 13:27:01,083 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:27:01,093 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 13:27:02,218 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:27:02,219 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 13:45:27,961 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 13:45:31,082 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 13:45:31,283 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 13:45:33,686 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 13:45:33,691 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 13:45:33,712 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 13:45:33,713 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 13:45:39,655 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_134527]: 客户中存款小于一百万的有哪些？列出名字
2025-11-25 13:45:55,959 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:45:55,968 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT DISTINCT ci.CUST_NAM 
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
WHERE (CASE db.CCY_CD 
    WHEN 'CNY' THEN db.CUR_BAL + db.FIX_BAL 
    WHEN 'USD' THEN (db.CUR_BAL + db.FIX_BAL) * 7 
    WHEN 'EUR' THEN (db.CUR_BAL + db.FIX_BAL) * (7 / 0.9) 
    ELSE (db.CUR_BAL + db.FIX_BAL) 
END) < 1000000;
2025-11-25 13:45:58,321 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:45:58,324 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT DISTINCT ci.CUST_NAM
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
WHERE (db.CUR_BAL + db.FIX_BAL - db.FROZEN_AMT) < 1000000.00
  AND ci.CUST_STATUS = '0';，当前重试次数: 1
2025-11-25 13:45:59,801 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:45:59,805 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 13:46:02,034 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:46:02,040 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 13:47:58,261 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_134527]: 哪些客户需要本月还贷
2025-11-25 13:47:58,997 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:47:58,999 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中存款小于一百万的有哪些？列出名字
                ...
2025-11-25 13:48:14,659 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:48:14,663 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT DISTINCT ci.CUST_NAM 
FROM customer_info ci
INNER JOIN deposit_business db ON ci.CUST_NO = db.CUST_NO
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE (db.CUR_BAL + db.FIX_BAL) < 1000000.00 
  AND lb.MTH_DUE_AMT > 0;
2025-11-25 13:48:19,885 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:48:19,886 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    ci.CUST_NO,
    ci.CUST_NAM,
    ci.MOBILE_N,
    lb.DUE_BILL_NO,
    lb.LN_ACCT_NO,
    lb.MTH_DUE_AMT
FROM 
    customer_info ci
INNER JOIN 
    loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE 
    lb.LN_STATUS IN ('01', '02') 
    AND lb.MTH_DUE_AMT > 0
    AND ci.CUST_STATUS = '0'
ORDER BY 
    lb.MTH_DUE_AMT DESC;，当前重试次数: 1
2025-11-25 13:48:21,834 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:48:21,844 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 13:49:07,080 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:49:07,085 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 13:51:19,832 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_134527]: 所有客户中应还金额最少的是谁？
2025-11-25 13:51:20,686 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:51:20,689 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中存款小于一百万的有哪些？列出名字
历史问题 2: 哪些客户需要本月...
2025-11-25 13:51:33,914 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:51:33,915 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NAM, lb.MTH_DUE_AMT 
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
WHERE lb.LN_STATUS IN ('01', '02') -- 假设01-正常，02-逾期等有效还款状态
ORDER BY lb.MTH_DUE_AMT ASC
LIMIT 1;
2025-11-25 13:51:36,721 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:51:36,725 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT ci.CUST_NAM
FROM customer_info ci
INNER JOIN loan_business lb ON ci.CUST_NO = lb.CUST_NO
ORDER BY lb.MTH_DUE_AMT ASC
LIMIT 1;，当前重试次数: 1
2025-11-25 13:51:37,968 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:51:37,971 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 13:51:38,881 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:51:38,884 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 13:59:38,579 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_134527]: 所有客户平均这个月应还多少贷款？
2025-11-25 13:59:39,606 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:59:39,608 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 客户中存款小于一百万的有哪些？列出名字
历史问题 2: 哪些客户需要本月...
2025-11-25 13:59:44,305 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:59:44,307 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT AVG(MTH_DUE_AMT) AS avg_monthly_repayment FROM loan_business;
2025-11-25 13:59:47,120 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:59:47,124 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT AVG(MTH_DUE_AMT) AS avg_monthly_repayment
FROM loan_business
WHERE LN_STATUS IN ('01', '02') 
  AND CUST_NO IN (SELECT CUST_NO FROM customer_info WHERE CUST_STATUS = '0');，当前重试次数: 1
2025-11-25 13:59:48,597 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:59:48,603 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 13:59:49,347 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 13:59:49,348 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 14:01:16,756 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 14:01:16,877 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 14:01:19,236 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 14:01:19,239 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 14:01:19,255 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 14:01:19,255 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 14:01:19,256 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_retry_session_1]: 查询不存在的表中不存在的列
2025-11-25 14:01:25,869 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:01:25,895 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT 'Error: The requested table or column does not exist in the database schema.' AS error_message
2025-11-25 14:01:27,265 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:01:27,266 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: 请提供需要优化的具体SQL查询语句。当前请求中“原始查询”描述为“查询不存在的表中不存在的列”，但未给出实际SQL语句，无法进行优化。，当前重试次数: 1
2025-11-25 14:01:27,270 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '请提供需要优化的具体SQL查询语句。当前请求中“原始查询â\x80' at line 1")
[SQL: 请提供需要优化的具体SQL查询语句。当前请求中“原始查询”描述为“查询不存在的表中不存在的列”，但未给出实际SQL语句，无法进行优化。]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-25 14:01:28,519 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:01:28,520 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: 请提供需要优化的具体SQL查询语句。当前请求中“原始查询”描述为“查询不存在的表中不存在的列”，但未给出实际SQL语句，无法进行优化。，当前重试次数: 2
2025-11-25 14:01:28,522 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '请提供需要优化的具体SQL查询语句。当前请求中“原始查询â\x80' at line 1")
[SQL: 请提供需要优化的具体SQL查询语句。当前请求中“原始查询”描述为“查询不存在的表中不存在的列”，但未给出实际SQL语句，无法进行优化。]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-25 14:01:28,523 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: SQL执行失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '请提供需要优化的具体SQL查询语句。当前请求中“原始查询â\x80' at line 1")
[SQL: 请提供需要优化的具体SQL查询语句。当前请求中“原始查询”描述为“查询不存在的表中不存在的列”，但未给出实际SQL语句，无法进行优化。]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-25 14:02:43,693 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 14:02:43,783 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 14:02:46,200 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 14:02:46,204 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 14:02:46,225 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 14:02:46,226 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 14:02:46,226 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [test_retry_session_1]: 查询所有用户的姓名和年龄
2025-11-25 14:03:00,036 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:03:00,044 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM, TIMESTAMPDIFF(YEAR, STR_TO_DATE(BIRTH_DT, '%Y%m%d'), CURDATE()) AS AGE FROM customer_info;
2025-11-25 14:03:03,574 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:03:03,579 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM AS 姓名, 
       TIMESTAMPDIFF(YEAR, STR_TO_DATE(BIRTH_DT, '%Y%m%d'), CURDATE()) AS 年龄
FROM customer_info
WHERE BIRTH_DT IS NOT NULL AND BIRTH_DT != '';，当前重试次数: 1
2025-11-25 14:03:05,097 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:03:05,100 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 14:03:19,182 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 14:03:19,183 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 16:11:35,614 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 16:11:39,977 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 16:11:40,314 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 16:11:42,867 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 16:11:42,870 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 16:11:42,887 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 16:11:42,888 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 16:52:43,670 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_161135]: 按年纪大小将客户排序，年纪小的在前
2025-11-25 16:52:50,194 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:52:50,204 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT DESC LIMIT None;
2025-11-25 16:52:51,725 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:52:51,726 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * 
FROM customer_info 
ORDER BY STR_TO_DATE(BIRTH_DT, '%Y%m%d') ASC;，当前重试次数: 1
2025-11-25 16:52:53,206 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:52:53,211 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 16:53:23,482 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:53:23,488 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 16:54:45,736 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_161135]: 数据库一共多少位客户
2025-11-25 16:54:48,081 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:54:48,086 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前
                  ...
2025-11-25 16:54:54,813 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:54:54,819 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT COUNT(*) AS total_customers FROM customer_info;
2025-11-25 16:54:56,172 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:54:56,176 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT COUNT(*) AS customer_count FROM customer_info;，当前重试次数: 1
2025-11-25 16:54:57,938 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:54:57,960 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 16:54:58,771 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:54:58,778 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 16:57:15,020 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_161135]: 那为什么你按年纪大小排序缺只排了49个？
2025-11-25 16:57:16,763 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:57:16,765 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前
历史问题 2: 数据库一共多少位客户...
2025-11-25 16:57:21,491 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:57:21,492 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT COUNT(*) AS total_customers FROM customer_info;
2025-11-25 16:57:23,748 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:57:23,752 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    ci.CUST_NAM,
    ci.BIRTH_DT,
    TIMESTAMPDIFF(YEAR, STR_TO_DATE(ci.BIRTH_DT, '%Y%m%d'), CURDATE()) AS age
FROM 
    customer_info ci
WHERE 
    ci.CUST_STATUS = '0'
ORDER BY 
    age DESC;，当前重试次数: 1
2025-11-25 16:57:25,063 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:57:25,074 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 16:57:29,046 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 16:57:29,052 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:03:48,339 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_161135]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序
2025-11-25 17:03:49,094 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:03:49,095 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前
历史问题 2: 数据库一共多少位客户...
2025-11-25 17:03:55,869 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:03:55,871 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY CUST_STATUS, BIRTH_DT DESC
2025-11-25 17:04:00,759 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:04:00,762 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    `CUST_NO`, 
    `CUST_NAM`, 
    `ID_TYPE`, 
    `ID_NO`, 
    `BIRTH_DT`, 
    `GENDER`, 
    `MOBILE_N`, 
    `ADDRESS`, 
    `OCCUP_CD`, 
    `RISK_LEVEL`, 
    `CUST_STATUS`, 
    `OPEN_ORG`
FROM 
    customer_info
ORDER BY 
    STR_TO_DATE(`BIRTH_DT`, '%Y%m%d') ASC;，当前重试次数: 1
2025-11-25 17:04:02,268 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:04:02,278 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:06:49,912 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:06:49,914 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:10:26,942 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_161135]: 所有客户中年纪最大的是谁
2025-11-25 17:10:30,027 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:10:30,032 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 数据库一共多少位客户
历史问题 2: 那为什么你按年纪大小排序缺只排了4...
2025-11-25 17:10:37,232 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:10:37,238 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM, BIRTH_DT FROM customer_info ORDER BY BIRTH_DT DESC LIMIT 1;
2025-11-25 17:10:38,541 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:10:38,545 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM 
FROM customer_info 
WHERE CUST_STATUS = '0' 
ORDER BY BIRTH_DT ASC 
LIMIT 1;，当前重试次数: 1
2025-11-25 17:10:39,594 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:10:39,604 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:10:40,117 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:10:40,119 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:14:23,545 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_161135]: 1.	高风险客户比低风险客户多还是少这种回答不出来
2025-11-25 17:14:25,265 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:14:25,267 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 那为什么你按年纪大小排序缺只排了49个？
历史问题 2: 按年纪大小将客...
2025-11-25 17:14:34,463 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:14:34,469 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT 
    (SELECT COUNT(*) FROM customer_info WHERE RISK_LEVEL = '03') AS high_risk_count,
    (SELECT COUNT(*) FROM customer_info WHERE RISK_LEVEL = '01') AS low_risk_count,
    CASE 
        WHEN (SELECT COUNT(*) FROM customer_info WHERE RISK_LEVEL = '03') > (SELECT COUNT(*) FROM customer_info WHERE RISK_LEVEL = '01') 
        THEN '高风险客户多'
        WHEN (SELECT COUNT(*) FROM customer_info WHERE RISK_LEVEL = '03') < (SELECT COUNT(*) FROM customer_info WHERE RISK_LEVEL = '01') 
        THEN '低风险客户多'
        ELSE '高风险客户与低风险客户数量相等'
    END AS comparison_result;
2025-11-25 17:14:39,088 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:14:39,090 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    SUM(CASE WHEN ci.RISK_LEVEL = '03' THEN 1 ELSE 0 END) AS high_risk_count,
    SUM(CASE WHEN ci.RISK_LEVEL = '01' THEN 1 ELSE 0 END) AS low_risk_count,
    CASE 
        WHEN SUM(CASE WHEN ci.RISK_LEVEL = '03' THEN 1 ELSE 0 END) > SUM(CASE WHEN ci.RISK_LEVEL = '01' THEN 1 ELSE 0 END) THEN '高风险客户多'
        WHEN SUM(CASE WHEN ci.RISK_LEVEL = '03' THEN 1 ELSE 0 END) < SUM(CASE WHEN ci.RISK_LEVEL = '01' THEN 1 ELSE 0 END) THEN '低风险客户多'
        ELSE '相同数量'
    END AS comparison_result
FROM customer_info ci
WHERE ci.CUST_STATUS = '0';，当前重试次数: 1
2025-11-25 17:14:40,654 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:14:40,657 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:14:42,246 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:14:42,248 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:28:38,789 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 17:28:41,784 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 17:28:42,017 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 17:28:44,358 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 17:28:44,361 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 17:28:44,376 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 17:28:44,377 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 17:28:49,178 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_172838]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序
2025-11-25 17:28:55,410 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:28:55,427 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT DESC LIMIT None;
2025-11-25 17:28:58,429 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:28:58,430 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    CUST_NO,
    CUST_NAM,
    ID_TYPE,
    ID_NO,
    BIRTH_DT,
    GENDER,
    MOBILE_N,
    ADDRESS,
    OCCUP_CD,
    RISK_LEVEL,
    CUST_STATUS,
    OPEN_ORG
FROM customer_info
ORDER BY STR_TO_DATE(BIRTH_DT, '%Y%m%d') ASC;，当前重试次数: 1
2025-11-25 17:28:59,623 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:28:59,624 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: SELECT 
    CUST_NO,
    CUST_NAM,
    ID_TYPE,
    ID_NO,
    BIRTH_DT,
    GENDER,
    MOBILE_N,
    ADDRESS,
    OCCUP_CD,
    RISK_LEVEL,
    CUST_STATUS,
    OPEN_ORG
FROM customer_info
ORDER BY STR_TO_DATE(BIRTH_DT, '%Y%m%d') ASC;
2025-11-25 17:28:59,627 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: 'RMKeyView' object is not subscriptable
2025-11-25 17:29:03,096 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:29:03,100 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    CUST_NO,
    CUST_NAM,
    ID_TYPE,
    ID_NO,
    BIRTH_DT,
    GENDER,
    MOBILE_N,
    ADDRESS,
    OCCUP_CD,
    RISK_LEVEL,
    CUST_STATUS,
    OPEN_ORG
FROM customer_info
ORDER BY BIRTH_DT ASC;，当前重试次数: 2
2025-11-25 17:29:04,322 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:29:04,327 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: SELECT 
    CUST_NO,
    CUST_NAM,
    ID_TYPE,
    ID_NO,
    BIRTH_DT,
    GENDER,
    MOBILE_N,
    ADDRESS,
    OCCUP_CD,
    RISK_LEVEL,
    CUST_STATUS,
    OPEN_ORG
FROM customer_info
ORDER BY BIRTH_DT ASC;
2025-11-25 17:29:04,335 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: 'RMKeyView' object is not subscriptable
2025-11-25 17:29:04,337 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: SQL执行失败: 'RMKeyView' object is not subscriptable
2025-11-25 17:32:35,329 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 17:32:38,257 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 17:32:38,449 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 17:32:40,758 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 17:32:40,761 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 17:32:40,778 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 17:32:40,778 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 17:32:43,173 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_173235]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序
2025-11-25 17:32:53,135 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:32:53,160 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT DESC LIMIT None;
2025-11-25 17:32:55,314 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:32:55,315 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    CUST_NO,
    CUST_NAM,
    ID_TYPE,
    ID_NO,
    BIRTH_DT,
    GENDER,
    MOBILE_N,
    ADDRESS,
    OCCUP_CD,
    RISK_LEVEL,
    CUST_STATUS,
    OPEN_ORG
FROM customer_info
ORDER BY STR_TO_DATE(BIRTH_DT, '%Y%m%d') ASC;，当前重试次数: 1
2025-11-25 17:32:56,890 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:32:56,896 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: SELECT 
    CUST_NO,
    CUST_NAM,
    ID_TYPE,
    ID_NO,
    BIRTH_DT,
    GENDER,
    MOBILE_N,
    ADDRESS,
    OCCUP_CD,
    RISK_LEVEL,
    CUST_STATUS,
    OPEN_ORG
FROM customer_info
ORDER BY STR_TO_DATE(BIRTH_DT, '%Y%m%d') ASC;
2025-11-25 17:32:56,903 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回50行结果
2025-11-25 17:36:00,013 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:36:00,022 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:37:39,932 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_173235]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输出名字
2025-11-25 17:37:41,975 - openai._base_client - INFO - Retrying request to /chat/completions in 0.492301 seconds
2025-11-25 17:37:44,507 - openai._base_client - INFO - Retrying request to /chat/completions in 0.768416 seconds
2025-11-25 17:37:47,292 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询增强失败: Connection error.
2025-11-25 17:37:49,365 - openai._base_client - INFO - Retrying request to /chat/completions in 0.397958 seconds
2025-11-25 17:37:51,799 - openai._base_client - INFO - Retrying request to /chat/completions in 0.911519 seconds
2025-11-25 17:37:54,734 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: Connection error.
2025-11-25 17:37:56,790 - openai._base_client - INFO - Retrying request to /chat/completions in 0.404125 seconds
2025-11-25 17:37:59,228 - openai._base_client - INFO - Retrying request to /chat/completions in 0.777055 seconds
2025-11-25 17:38:02,045 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: Connection error.
2025-11-25 17:38:02,047 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: 
2025-11-25 17:38:02,049 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1065, 'Query was empty')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 17:38:04,090 - openai._base_client - INFO - Retrying request to /chat/completions in 0.433383 seconds
2025-11-25 17:38:06,583 - openai._base_client - INFO - Retrying request to /chat/completions in 0.803630 seconds
2025-11-25 17:38:09,440 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: Connection error.
2025-11-25 17:38:09,444 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: 
2025-11-25 17:38:09,447 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1065, 'Query was empty')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 17:38:09,451 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: SQL执行失败: (pymysql.err.OperationalError) (1065, 'Query was empty')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 17:38:27,086 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_173235]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输出名字
2025-11-25 17:38:29,126 - openai._base_client - INFO - Retrying request to /chat/completions in 0.464882 seconds
2025-11-25 17:38:31,653 - openai._base_client - INFO - Retrying request to /chat/completions in 0.769169 seconds
2025-11-25 17:38:34,463 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询增强失败: Connection error.
2025-11-25 17:38:36,521 - openai._base_client - INFO - Retrying request to /chat/completions in 0.422361 seconds
2025-11-25 17:38:38,994 - openai._base_client - INFO - Retrying request to /chat/completions in 0.818395 seconds
2025-11-25 17:38:41,840 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL生成失败: Connection error.
2025-11-25 17:38:43,912 - openai._base_client - INFO - Retrying request to /chat/completions in 0.473168 seconds
2025-11-25 17:38:46,414 - openai._base_client - INFO - Retrying request to /chat/completions in 0.873573 seconds
2025-11-25 17:38:49,349 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: Connection error.
2025-11-25 17:38:49,353 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: 
2025-11-25 17:38:49,356 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1065, 'Query was empty')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 17:38:51,441 - openai._base_client - INFO - Retrying request to /chat/completions in 0.440429 seconds
2025-11-25 17:38:53,903 - openai._base_client - INFO - Retrying request to /chat/completions in 0.850225 seconds
2025-11-25 17:38:56,790 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL优化失败: Connection error.
2025-11-25 17:38:56,791 - text2sql_module.text2sql_processor_langgraph - INFO - 执行SQL查询: 
2025-11-25 17:38:56,794 - text2sql_module.text2sql_processor_langgraph - ERROR - SQL执行失败: (pymysql.err.OperationalError) (1065, 'Query was empty')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 17:38:56,795 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: SQL执行失败: (pymysql.err.OperationalError) (1065, 'Query was empty')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-25 17:39:06,314 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 17:39:09,195 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 17:39:09,387 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 17:39:10,482 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 17:39:10,486 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 17:39:10,503 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 17:39:10,503 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 17:39:11,876 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_173906]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输出名字
2025-11-25 17:39:18,196 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:39:18,211 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-25 17:39:19,658 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:39:19,662 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT ASC
2025-11-25 17:39:21,050 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:39:21,061 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:39:26,384 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:39:26,391 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:40:00,780 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_173906]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与，输出每个人详细信息
2025-11-25 17:40:01,653 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:40:01,655 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输...
2025-11-25 17:40:11,363 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:40:11,365 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-25 17:40:12,846 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:40:12,850 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT ASC
2025-11-25 17:40:14,387 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:40:14,393 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:44:08,479 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:44:08,485 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:45:14,539 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 17:45:17,459 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 17:45:17,687 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 17:45:18,832 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 17:45:18,836 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 17:45:18,851 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 17:45:18,852 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 17:45:21,616 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_174514]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与，输出每个人详细信息
2025-11-25 17:45:28,298 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:45:28,304 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-25 17:45:29,157 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:45:29,159 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT ASC
2025-11-25 17:45:30,105 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:45:30,121 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:45:30,125 - text2sql_module.text2sql_processor_langgraph - ERROR - 解释生成失败: "Input to PromptTemplate is missing variables {'raw_result'}.  Expected: ['query_result', 'question', 'raw_result', 'sql_query'] Received: ['question', 'sql_query', 'query_result']\nNote: if you intended {raw_result} to be part of the string and not a variable, please escape it with double curly braces like: '{{raw_result}}'.\nFor troubleshooting, visit: https://docs.langchain.com/oss/python/langchain/errors/INVALID_PROMPT_INPUT "
2025-11-25 17:45:30,127 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 优化后的SQL不符合安全规范: 只支持SELECT、SHOW、DESCRIBE查询
2025-11-25 17:51:04,293 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-25 17:51:07,206 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-25 17:51:07,394 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-25 17:51:08,519 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-25 17:51:08,523 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-25 17:51:08,541 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-25 17:51:08,541 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-25 17:51:10,718 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_175104]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输出名字
2025-11-25 17:51:17,841 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:51:17,864 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-25 17:51:19,507 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:51:19,509 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT ASC
2025-11-25 17:51:20,655 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:51:20,659 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:51:25,502 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:51:25,509 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:52:55,936 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_175104]: 我不是让你年纪小的在前面吗？你怎么年纪大的在前面？
2025-11-25 17:52:56,861 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:52:56,863 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输...
2025-11-25 17:53:03,607 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:53:03,613 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM, BIRTH_DT FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-25 17:53:05,291 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:53:05,295 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM, BIRTH_DT FROM customer_info ORDER BY BIRTH_DT ASC
2025-11-25 17:53:06,329 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:53:06,341 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-25 17:53:12,457 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:53:12,459 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-25 17:54:22,407 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_175104]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与，输出每个人详细信息
2025-11-25 17:54:23,435 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:54:23,436 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输...
2025-11-25 17:54:28,043 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:54:28,049 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-25 17:54:28,809 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:54:28,812 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT * FROM customer_info ORDER BY BIRTH_DT ASC
2025-11-25 17:54:30,211 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-25 17:54:30,227 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-26 08:30:42,824 - openai._base_client - INFO - Retrying request to /chat/completions in 0.422017 seconds
2025-11-26 08:30:44,523 - openai._base_client - INFO - Retrying request to /chat/completions in 0.939542 seconds
2025-11-26 08:30:45,470 - text2sql_module.text2sql_processor_langgraph - ERROR - 解释生成失败: Connection error.
2025-11-26 08:30:45,471 - text2sql_module.text2sql_processor_langgraph - ERROR - 查询处理失败: 优化后的SQL不符合安全规范: 只支持SELECT、SHOW、DESCRIBE查询
2025-11-26 08:58:07,652 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251125_175104]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与，输出每个人详细信息
2025-11-26 08:58:09,025 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 08:58:09,034 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输...
2025-11-26 08:58:18,962 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-26 08:58:24,243 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-26 08:58:24,616 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-26 08:58:27,378 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-26 08:58:27,382 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-26 08:58:27,402 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-26 08:58:27,402 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-26 08:58:30,715 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251126_085818]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输出名字
2025-11-26 08:58:35,714 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 08:58:35,723 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT DESC LIMIT 10;
2025-11-26 08:58:36,889 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 08:58:36,893 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT ASC LIMIT 10;
2025-11-26 08:58:38,875 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 08:58:38,883 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-26 08:58:41,711 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 08:58:41,715 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-26 09:07:31,873 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-26 09:07:35,055 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-26 09:07:35,354 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-26 09:07:37,837 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-26 09:07:37,841 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-26 09:07:37,862 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-26 09:07:37,862 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-26 09:07:40,607 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251126_090731]: 按年纪大小将客户排序，年纪小的在前，无论客户状态是否正常都参与排序，只输出名字
2025-11-26 09:07:46,961 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:07:46,972 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT DESC",
    "explanation": "根据用户需求，需要按年纪大小排序，年纪小的在前。年龄小意味着出生日期更晚，因此应按BIRTH_DT降序排列（DESC）。由于所有客户无论状态如何都要参与排序，无需添加WHERE条件过滤状态。只输出客户姓名（CUST_NAM）。",
    "tables_used": ["customer_info"],
    "fields_used": ["CUST_NAM", "BIRTH_DT"],
    "confidence": 0.95,
    "alternatives": [
        "SELECT CUST_NAM FROM customer_info ORDER BY STR_TO_DATE(BIRTH_DT, '%Y%m%d') DESC",
        "SELECT CUST_NAM FROM customer_info ORDER BY SUBSTR(BIRTH_DT, 1, 4) DESC, SUBSTR(BIRTH_DT, 5, 2) DESC, SUBSTR(BIRTH_DT, 7, 2) DESC"
    ]
}
2025-11-26 09:07:48,144 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:07:48,145 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT CUST_NAM FROM customer_info ORDER BY BIRTH_DT DESC
2025-11-26 09:07:49,421 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:07:49,424 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-26 09:07:55,144 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:07:55,146 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-26 09:48:08,668 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-26 09:48:13,224 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-26 09:48:13,569 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-26 09:48:16,319 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-26 09:48:16,324 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-26 09:48:16,349 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-26 09:48:16,349 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-26 09:49:35,740 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251126_094808]: 所有女客户的平均存款和所有男客户的所有存款比谁的高？
2025-11-26 09:49:50,067 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:49:50,092 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT 
    'female_avg_deposit' AS comparison_type,
    AVG(d.CUR_BAL + d.FIX_BAL) AS amount
FROM customer_info c
INNER JOIN deposit_business d ON c.CUST_NO = d.CUST_NO
WHERE c.GENDER = '2'

UNION ALL

SELECT 
    'male_total_deposit' AS comparison_type,
    SUM(d.CUR_BAL + d.FIX_BAL) AS amount
FROM customer_info c
INNER JOIN deposit_business d ON c.CUST_NO = d.CUST_NO
WHERE c.GENDER = '1';
2025-11-26 09:49:53,390 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:49:53,391 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    'female_avg_deposit' AS comparison_type,
    AVG(d.CUR_BAL + d.FIX_BAL) AS amount
FROM customer_info c
INNER JOIN deposit_business d ON c.CUST_NO = d.CUST_NO
WHERE c.GENDER = '2'

UNION ALL

SELECT 
    'male_total_deposit' AS comparison_type,
    SUM(d.CUR_BAL + d.FIX_BAL) AS amount
FROM customer_info c
INNER JOIN deposit_business d ON c.CUST_NO = d.CUST_NO
WHERE c.GENDER = '1';
2025-11-26 09:49:55,078 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:49:55,082 - text2sql_module.text2sql_processor_langgraph - INFO - LLM验证结果格式不完整，使用基础验证结果
2025-11-26 09:49:55,092 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-26 09:49:57,097 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:49:57,098 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-26 09:51:28,582 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251126_094808]: 你是不是没有把所有货币换算成人民币？
2025-11-26 09:51:29,890 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:51:29,891 - text2sql_module.text2sql_processor_langgraph - INFO - 将用户历史记录作为上下文提示词传递给大模型: 
                        上下文信息：
                        历史问题 1: 所有女客户的平均存款和所有男客户的所有存款比谁的高？
         ...
2025-11-26 09:51:49,826 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:51:49,828 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT 
    GENDER,
    AVG(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL
                WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7
                WHEN CCY_CD = 'EUR' THEN (CUR_BAL + FIX_BAL) * (7 / 0.9)
                ELSE (CUR_BAL + FIX_BAL) END) AS avg_total_balance_cny,
    SUM(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL
              WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7
              WHEN CCY_CD = 'EUR' THEN (CUR_BAL + FIX_BAL) * (7 / 0.9)
              ELSE (CUR_BAL + FIX_BAL) END) AS total_balance_cny
FROM deposit_business 
JOIN customer_info ON deposit_business.CUST_NO = customer_info.CUST_NO
GROUP BY GENDER;
2025-11-26 09:51:55,028 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:51:55,030 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT 
    GENDER,
    AVG(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL
             WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7
             WHEN CCY_CD = 'EUR' THEN (CUR_BAL + FIX_BAL) * (7 / 0.9)
             ELSE (CUR_BAL + FIX_BAL) * 1 END) AS avg_total_balance_cny,
    SUM(CASE WHEN CCY_CD = 'CNY' THEN CUR_BAL + FIX_BAL
             WHEN CCY_CD = 'USD' THEN (CUR_BAL + FIX_BAL) * 7
             WHEN CCY_CD = 'EUR' THEN (CUR_BAL + FIX_BAL) * (7 / 0.9)
             ELSE (CUR_BAL + FIX_BAL) * 1 END) AS total_balance_cny
FROM deposit_business 
JOIN customer_info ON deposit_business.CUST_NO = customer_info.CUST_NO
GROUP BY GENDER;
2025-11-26 09:51:56,889 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:51:56,893 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-26 09:52:04,031 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 09:52:04,033 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
2025-11-26 10:24:07,920 - logger_set - INFO - 日志系统初始化完成，将记录到myagent.log文件
2025-11-26 10:24:11,180 - root - INFO - 从 C:\Lt\xunishuju\myagent\text2sql_module\.env 加载环境变量成功
2025-11-26 10:24:11,495 - text2sql_module.text2sql_processor_langgraph - INFO - 数据库连接初始化成功
2025-11-26 10:24:13,923 - text2sql_module.text2sql_processor_langgraph - INFO - 语言模型初始化成功
2025-11-26 10:24:13,926 - text2sql_module.text2sql_processor_langgraph - INFO - 所有提示词初始化成功
2025-11-26 10:24:13,941 - text2sql_module.text2sql_processor_langgraph - INFO - LangGraph工作流初始化成功
2025-11-26 10:24:13,941 - text2sql_module.text2sql_processor_langgraph - INFO - Text2SQL处理器初始化完成，模型: qwen-plus
2025-11-26 10:24:53,670 - text2sql_module.text2sql_processor_langgraph - INFO - 处理查询 [cli_session_20251126_102407]: 渠道活跃度评分大于80分的有哪些人？请列出来。
2025-11-26 10:25:01,246 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 10:25:01,255 - text2sql_module.text2sql_processor_langgraph - INFO - 生成的SQL: SELECT ci.CUST_NO, ci.CUST_NAM 
FROM customer_info ci
INNER JOIN customer_channel_preference ccp ON ci.CUST_NO = ccp.CUST_NO
WHERE ccp.CHANNEL_ACTIVE_SCORE > 80;
2025-11-26 10:25:03,434 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 10:25:03,435 - text2sql_module.text2sql_processor_langgraph - INFO - 优化后的SQL: SELECT ci.CUST_NO, ci.CUST_NAM 
FROM customer_info ci
INNER JOIN customer_channel_preference ccp ON ci.CUST_NO = ccp.CUST_NO
WHERE ccp.CHANNEL_ACTIVE_SCORE > 80;
2025-11-26 10:25:05,048 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 10:25:05,050 - text2sql_module.text2sql_processor_langgraph - INFO - SQL执行成功，返回1行结果
2025-11-26 10:25:10,347 - httpx - INFO - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 10:25:10,348 - text2sql_module.text2sql_processor_langgraph - INFO - 查询处理成功，返回0行结果
